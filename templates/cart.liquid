{%- comment -%}
  Shelzy's Designs - Cart Template

  Conversion-optimized cart page with:
  - Clear cart items display
  - Quantity adjustment
  - Upsells and cross-sells
  - Trust signals
  - Free shipping progress bar
{%- endcomment -%}

<div class="sz-cart-page">
  <div class="sz-cart-container">

    <h1 class="sz-cart-title">Your Cart</h1>

    {%- if cart.item_count > 0 -%}

      <div class="sz-cart-layout">

        {%- comment -%} Cart Items {%- endcomment -%}
        <div class="sz-cart-items">

          {%- comment -%} Free Shipping Progress {%- endcomment -%}
          {% assign free_shipping_threshold = 7500 %}
          {% assign cart_total = cart.total_price %}
          {% assign remaining = free_shipping_threshold | minus: cart_total %}
          {% assign progress_percent = cart_total | times: 100 | divided_by: free_shipping_threshold %}
          {% if progress_percent > 100 %}{% assign progress_percent = 100 %}{% endif %}

          <div class="sz-cart-shipping-progress">
            {%- if remaining > 0 -%}
              <p class="sz-shipping-message">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="1" y="3" width="15" height="13"/>
                  <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/>
                  <circle cx="5.5" cy="18.5" r="2.5"/>
                  <circle cx="18.5" cy="18.5" r="2.5"/>
                </svg>
                Add <strong>{{ remaining | money }}</strong> more for <strong>FREE shipping!</strong>
              </p>
            {%- else -%}
              <p class="sz-shipping-message sz-shipping-qualified">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                  <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                <strong>You've qualified for FREE shipping!</strong>
              </p>
            {%- endif -%}
            <div class="sz-shipping-bar">
              <div class="sz-shipping-bar-fill" style="width: {{ progress_percent }}%"></div>
            </div>
          </div>

          {%- comment -%} Cart Table {%- endcomment -%}
          <form action="/cart" method="post" id="cart-form">
            <div class="sz-cart-table">

              {%- for item in cart.items -%}
                <div class="sz-cart-item" data-variant-id="{{ item.variant_id }}">

                  {%- comment -%} Product Image {%- endcomment -%}
                  <div class="sz-cart-item-image">
                    <a href="{{ item.url }}">
                      {%- if item.image -%}
                        <img
                          src="{{ item.image | image_url: width: 200 }}"
                          alt="{{ item.title }}"
                          loading="lazy"
                        >
                      {%- else -%}
                        <div class="sz-cart-placeholder">No image</div>
                      {%- endif -%}
                    </a>
                  </div>

                  {%- comment -%} Product Info {%- endcomment -%}
                  <div class="sz-cart-item-info">
                    <h3 class="sz-cart-item-title">
                      <a href="{{ item.url }}">{{ item.product.title }}</a>
                    </h3>

                    {%- unless item.product.has_only_default_variant -%}
                      <p class="sz-cart-item-variant">{{ item.variant.title }}</p>
                    {%- endunless -%}

                    {%- comment -%} Line item properties (personalization) {%- endcomment -%}
                    {%- if item.properties.size > 0 -%}
                      <ul class="sz-cart-item-properties">
                        {%- for property in item.properties -%}
                          {%- unless property.last == blank -%}
                            <li><strong>{{ property.first }}:</strong> {{ property.last }}</li>
                          {%- endunless -%}
                        {%- endfor -%}
                      </ul>
                    {%- endif -%}

                    <p class="sz-cart-item-price-mobile">{{ item.final_line_price | money }}</p>
                  </div>

                  {%- comment -%} Quantity {%- endcomment -%}
                  <div class="sz-cart-item-quantity">
                    <label class="visually-hidden" for="updates_{{ item.key }}">Quantity</label>
                    <div class="sz-qty-selector">
                      <button
                        type="button"
                        class="sz-qty-btn sz-qty-decrease"
                        aria-label="Decrease quantity"
                        data-key="{{ item.key }}"
                      >−</button>
                      <input
                        type="number"
                        name="updates[]"
                        id="updates_{{ item.key }}"
                        value="{{ item.quantity }}"
                        min="0"
                        max="99"
                        class="sz-qty-input"
                        aria-label="Quantity for {{ item.title }}"
                      >
                      <button
                        type="button"
                        class="sz-qty-btn sz-qty-increase"
                        aria-label="Increase quantity"
                        data-key="{{ item.key }}"
                      >+</button>
                    </div>
                    <button
                      type="button"
                      class="sz-cart-item-remove"
                      aria-label="Remove {{ item.title }} from cart"
                      data-key="{{ item.key }}"
                    >
                      Remove
                    </button>
                  </div>

                  {%- comment -%} Price {%- endcomment -%}
                  <div class="sz-cart-item-price">
                    {%- if item.original_line_price != item.final_line_price -%}
                      <span class="sz-cart-original-price">{{ item.original_line_price | money }}</span>
                    {%- endif -%}
                    <span class="sz-cart-final-price">{{ item.final_line_price | money }}</span>
                  </div>

                </div>
              {%- endfor -%}

            </div>

            <input type="hidden" name="checkout" value="">
          </form>

        </div>

        {%- comment -%} Cart Summary {%- endcomment -%}
        <div class="sz-cart-summary">
          <div class="sz-cart-summary-inner">

            <h2 class="sz-summary-title">Order Summary</h2>

            <div class="sz-summary-row">
              <span>Subtotal ({{ cart.item_count }} {{ cart.item_count | pluralize: 'item', 'items' }})</span>
              <span>{{ cart.total_price | money }}</span>
            </div>

            {%- if cart.cart_level_discount_applications.size > 0 -%}
              {%- for discount in cart.cart_level_discount_applications -%}
                <div class="sz-summary-row sz-summary-discount">
                  <span>{{ discount.title }}</span>
                  <span>-{{ discount.total_allocated_amount | money }}</span>
                </div>
              {%- endfor -%}
            {%- endif -%}

            <div class="sz-summary-row sz-summary-shipping">
              <span>Shipping</span>
              <span>{%- if remaining <= 0 -%}FREE{%- else -%}Calculated at checkout{%- endif -%}</span>
            </div>

            <div class="sz-summary-row sz-summary-total">
              <span>Estimated Total</span>
              <span>{{ cart.total_price | money }}</span>
            </div>

            {%- comment -%} Checkout Button {%- endcomment -%}
            <a href="/checkout" class="sz-btn sz-btn-primary sz-btn-checkout">
              Proceed to Checkout
            </a>

            {%- comment -%} Continue Shopping {%- endcomment -%}
            <a href="/collections/all" class="sz-continue-shopping">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="19" y1="12" x2="5" y2="12"/>
                <polyline points="12 19 5 12 12 5"/>
              </svg>
              Continue Shopping
            </a>

            {%- comment -%} Trust Signals {%- endcomment -%}
            <div class="sz-cart-trust">
              <div class="sz-trust-badge">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                  <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
                <span>Secure Checkout</span>
              </div>
              <div class="sz-trust-badge">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                  <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                <span>No-Peel Guarantee</span>
              </div>
              <div class="sz-trust-badge">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <polyline points="12 6 12 12 16 14"/>
                </svg>
                <span>Ships in 3-5 Days</span>
              </div>
            </div>

            {%- comment -%} Payment Icons {%- endcomment -%}
            <div class="sz-payment-icons">
              <span class="sz-payment-label">We Accept:</span>
              <div class="sz-payment-badges">
                {{ shop.enabled_payment_types | payment_type_svg_tag }}
              </div>
            </div>

          </div>
        </div>

      </div>

      {%- comment -%} Upsell Section {%- endcomment -%}
      {% render 'shelzys-cart-upsell' %}

    {%- else -%}

      {%- comment -%} Empty Cart {%- endcomment -%}
      <div class="sz-cart-empty">
        <div class="sz-cart-empty-icon">
          <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="var(--sz-primary)" stroke-width="1.5">
            <circle cx="9" cy="21" r="1"/>
            <circle cx="20" cy="21" r="1"/>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
          </svg>
        </div>
        <h2 class="sz-cart-empty-title">Your cart is empty</h2>
        <p class="sz-cart-empty-text">Looks like you haven't added any personalized bottles yet. Let's fix that!</p>
        <a href="/collections/all" class="sz-btn sz-btn-primary">Start Shopping</a>
      </div>

    {%- endif -%}

  </div>
</div>

<style>
  /* ═══════════════════════════════════════════════════════════════════
     CART PAGE STYLES
     ═══════════════════════════════════════════════════════════════════ */
  .sz-cart-page {
    padding: var(--sz-space-xl) var(--sz-space-md);
    background: var(--sz-warm-white);
    min-height: 60vh;
  }

  .sz-cart-container {
    max-width: 1200px;
    margin: 0 auto;
  }

  .sz-cart-title {
    font-family: var(--sz-font-heading);
    font-size: clamp(1.75rem, 4vw, 2.5rem);
    font-weight: 600;
    color: var(--sz-primary-dark);
    margin: 0 0 var(--sz-space-xl) 0;
    text-align: center;
  }

  .sz-cart-layout {
    display: grid;
    grid-template-columns: 1fr 380px;
    gap: var(--sz-space-xl);
    align-items: start;
  }

  @media (max-width: 900px) {
    .sz-cart-layout {
      grid-template-columns: 1fr;
    }
  }

  /* Free Shipping Progress */
  .sz-cart-shipping-progress {
    background: var(--sz-white);
    padding: var(--sz-space-lg);
    border-radius: var(--sz-radius-md);
    margin-bottom: var(--sz-space-lg);
    border: 1px solid var(--sz-border-light);
  }

  .sz-shipping-message {
    display: flex;
    align-items: center;
    gap: var(--sz-space-sm);
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-sm);
    color: var(--sz-charcoal);
    margin: 0 0 var(--sz-space-sm) 0;
  }

  .sz-shipping-message svg {
    color: var(--sz-primary);
    flex-shrink: 0;
  }

  .sz-shipping-qualified {
    color: var(--sz-success);
  }

  .sz-shipping-qualified svg {
    color: var(--sz-success);
  }

  .sz-shipping-bar {
    height: 8px;
    background: var(--sz-beige);
    border-radius: var(--sz-radius-full);
    overflow: hidden;
  }

  .sz-shipping-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--sz-primary), var(--sz-primary-dark));
    border-radius: var(--sz-radius-full);
    transition: width var(--sz-transition-normal);
  }

  /* Cart Items */
  .sz-cart-items {
    background: var(--sz-white);
    border-radius: var(--sz-radius-md);
    padding: var(--sz-space-lg);
  }

  .sz-cart-table {
    display: flex;
    flex-direction: column;
    gap: var(--sz-space-lg);
  }

  .sz-cart-item {
    display: grid;
    grid-template-columns: 100px 1fr auto auto;
    gap: var(--sz-space-md);
    align-items: center;
    padding-bottom: var(--sz-space-lg);
    border-bottom: 1px solid var(--sz-border-light);
  }

  .sz-cart-item:last-child {
    padding-bottom: 0;
    border-bottom: none;
  }

  @media (max-width: 700px) {
    .sz-cart-item {
      grid-template-columns: 80px 1fr;
      grid-template-rows: auto auto;
    }

    .sz-cart-item-quantity {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      gap: var(--sz-space-md);
    }

    .sz-cart-item-price {
      display: none;
    }

    .sz-cart-item-price-mobile {
      display: block !important;
    }
  }

  .sz-cart-item-image {
    width: 100px;
    aspect-ratio: 1;
    border-radius: var(--sz-radius-sm);
    overflow: hidden;
    background: var(--sz-beige);
  }

  .sz-cart-item-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .sz-cart-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--sz-text-xs);
    color: var(--sz-gray);
  }

  .sz-cart-item-info {
    min-width: 0;
  }

  .sz-cart-item-title {
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-base);
    font-weight: 500;
    margin: 0 0 var(--sz-space-xs) 0;
    line-height: 1.3;
  }

  .sz-cart-item-title a {
    color: var(--sz-charcoal);
    text-decoration: none;
  }

  .sz-cart-item-title a:hover {
    color: var(--sz-primary);
  }

  .sz-cart-item-variant {
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-sm);
    color: var(--sz-gray);
    margin: 0 0 var(--sz-space-xs) 0;
  }

  .sz-cart-item-properties {
    list-style: none;
    padding: 0;
    margin: var(--sz-space-xs) 0 0 0;
  }

  .sz-cart-item-properties li {
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-xs);
    color: var(--sz-gray);
    line-height: 1.4;
  }

  .sz-cart-item-price-mobile {
    display: none;
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-base);
    font-weight: 600;
    color: var(--sz-primary-dark);
    margin: var(--sz-space-sm) 0 0 0;
  }

  /* Quantity Selector */
  .sz-cart-item-quantity {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--sz-space-sm);
  }

  .sz-qty-selector {
    display: flex;
    align-items: center;
    border: 1px solid var(--sz-border-light);
    border-radius: var(--sz-radius-sm);
  }

  .sz-qty-btn {
    width: 36px;
    height: 36px;
    background: var(--sz-warm-white);
    border: none;
    font-size: 18px;
    cursor: pointer;
    transition: background var(--sz-transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .sz-qty-btn:hover {
    background: var(--sz-beige);
  }

  .sz-qty-input {
    width: 50px;
    height: 36px;
    text-align: center;
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-base);
    border: none;
    border-left: 1px solid var(--sz-border-light);
    border-right: 1px solid var(--sz-border-light);
  }

  .sz-qty-input:focus {
    outline: none;
  }

  .sz-cart-item-remove {
    background: none;
    border: none;
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-xs);
    color: var(--sz-gray);
    cursor: pointer;
    text-decoration: underline;
    transition: color var(--sz-transition-fast);
  }

  .sz-cart-item-remove:hover {
    color: var(--sz-error);
  }

  /* Price */
  .sz-cart-item-price {
    text-align: right;
    min-width: 80px;
  }

  .sz-cart-original-price {
    display: block;
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-sm);
    color: var(--sz-gray);
    text-decoration: line-through;
  }

  .sz-cart-final-price {
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-base);
    font-weight: 600;
    color: var(--sz-primary-dark);
  }

  /* Cart Summary */
  .sz-cart-summary {
    position: sticky;
    top: 100px;
  }

  @media (max-width: 900px) {
    .sz-cart-summary {
      position: static;
    }
  }

  .sz-cart-summary-inner {
    background: var(--sz-white);
    border-radius: var(--sz-radius-md);
    padding: var(--sz-space-xl);
    border: 1px solid var(--sz-border-light);
  }

  .sz-summary-title {
    font-family: var(--sz-font-heading);
    font-size: var(--sz-text-xl);
    font-weight: 600;
    color: var(--sz-primary-dark);
    margin: 0 0 var(--sz-space-lg) 0;
    padding-bottom: var(--sz-space-md);
    border-bottom: 1px solid var(--sz-border-light);
  }

  .sz-summary-row {
    display: flex;
    justify-content: space-between;
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-base);
    color: var(--sz-charcoal);
    margin-bottom: var(--sz-space-sm);
  }

  .sz-summary-discount span:last-child {
    color: var(--sz-success);
  }

  .sz-summary-shipping {
    padding-bottom: var(--sz-space-md);
    border-bottom: 1px solid var(--sz-border-light);
    margin-bottom: var(--sz-space-md);
  }

  .sz-summary-total {
    font-size: var(--sz-text-lg);
    font-weight: 600;
    color: var(--sz-primary-dark);
    margin-bottom: var(--sz-space-lg);
  }

  .sz-btn-checkout {
    width: 100%;
    padding: var(--sz-space-md);
    font-size: var(--sz-text-base);
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: var(--sz-space-md);
  }

  .sz-continue-shopping {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--sz-space-xs);
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-sm);
    color: var(--sz-primary);
    text-decoration: none;
    margin-bottom: var(--sz-space-xl);
    transition: color var(--sz-transition-fast);
  }

  .sz-continue-shopping:hover {
    color: var(--sz-primary-dark);
  }

  /* Trust Badges */
  .sz-cart-trust {
    display: flex;
    flex-direction: column;
    gap: var(--sz-space-sm);
    margin-bottom: var(--sz-space-lg);
    padding-top: var(--sz-space-lg);
    border-top: 1px solid var(--sz-border-light);
  }

  .sz-trust-badge {
    display: flex;
    align-items: center;
    gap: var(--sz-space-sm);
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-sm);
    color: var(--sz-charcoal);
  }

  .sz-trust-badge svg {
    color: var(--sz-primary);
    flex-shrink: 0;
  }

  /* Payment Icons */
  .sz-payment-icons {
    text-align: center;
    padding-top: var(--sz-space-md);
    border-top: 1px solid var(--sz-border-light);
  }

  .sz-payment-label {
    display: block;
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-xs);
    color: var(--sz-gray);
    margin-bottom: var(--sz-space-sm);
  }

  .sz-payment-badges {
    display: flex;
    justify-content: center;
    gap: var(--sz-space-xs);
    flex-wrap: wrap;
  }

  .sz-payment-badges svg {
    height: 24px;
    width: auto;
  }

  /* Empty Cart */
  .sz-cart-empty {
    text-align: center;
    padding: var(--sz-space-3xl) var(--sz-space-md);
  }

  .sz-cart-empty-icon {
    margin-bottom: var(--sz-space-xl);
  }

  .sz-cart-empty-title {
    font-family: var(--sz-font-heading);
    font-size: var(--sz-text-2xl);
    font-weight: 600;
    color: var(--sz-primary-dark);
    margin: 0 0 var(--sz-space-md) 0;
  }

  .sz-cart-empty-text {
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-base);
    color: var(--sz-charcoal);
    margin: 0 0 var(--sz-space-xl) 0;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }
</style>

<script>
(function() {
  // Quantity buttons
  document.querySelectorAll('.sz-qty-btn').forEach(function(btn) {
    btn.addEventListener('click', function() {
      var input = this.parentElement.querySelector('.sz-qty-input');
      var currentValue = parseInt(input.value) || 1;

      if (this.classList.contains('sz-qty-increase')) {
        input.value = currentValue + 1;
      } else if (this.classList.contains('sz-qty-decrease') && currentValue > 1) {
        input.value = currentValue - 1;
      }

      // Auto-submit form after quantity change
      updateCart(input);
    });
  });

  // Quantity input change
  document.querySelectorAll('.sz-qty-input').forEach(function(input) {
    input.addEventListener('change', function() {
      updateCart(this);
    });
  });

  // Remove item buttons
  document.querySelectorAll('.sz-cart-item-remove').forEach(function(btn) {
    btn.addEventListener('click', function() {
      var key = this.getAttribute('data-key');
      removeFromCart(key);
    });
  });

  function updateCart(input) {
    var form = document.getElementById('cart-form');
    if (form) {
      // Submit form to update cart
      var formData = new FormData(form);
      fetch('/cart/update.js', {
        method: 'POST',
        body: formData
      })
      .then(function(response) { return response.json(); })
      .then(function(data) {
        window.location.reload();
      });
    }
  }

  function removeFromCart(key) {
    fetch('/cart/change.js', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id: key, quantity: 0 })
    })
    .then(function(response) { return response.json(); })
    .then(function(data) {
      window.location.reload();
    });
  }
})();
</script>
