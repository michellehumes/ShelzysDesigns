{%- comment -%}
  Shelzy's Designs - Product Badges

  Displays contextual badges on product cards:
  - SALE (if on sale)
  - BESTSELLER (if tagged)
  - LOW STOCK (if inventory < 10)
  - NEW (if created within 30 days)

  Usage in collection/product cards:
  {% render 'shelzys-product-badges', product: product %}
{%- endcomment -%}

{% assign show_sale = false %}
{% assign show_bestseller = false %}
{% assign show_low_stock = false %}
{% assign show_new = false %}

{%- comment -%} Check for sale {%- endcomment -%}
{% if product.compare_at_price > product.price %}
  {% assign show_sale = true %}
  {% assign discount = product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price %}
{% endif %}

{%- comment -%} Check for bestseller tag {%- endcomment -%}
{% for tag in product.tags %}
  {% assign tag_lower = tag | downcase %}
  {% if tag_lower == 'bestseller' or tag_lower == 'best-seller' or tag_lower == 'best seller' %}
    {% assign show_bestseller = true %}
  {% endif %}
{% endfor %}

{%- comment -%} Check for low stock {%- endcomment -%}
{% assign variant = product.selected_or_first_available_variant %}
{% if variant.inventory_management == 'shopify' and variant.inventory_quantity > 0 and variant.inventory_quantity <= 10 %}
  {% assign show_low_stock = true %}
  {% assign stock_count = variant.inventory_quantity %}
{% endif %}

{%- comment -%} Check if new (within 30 days) {%- endcomment -%}
{% assign now = 'now' | date: '%s' %}
{% assign created = product.created_at | date: '%s' %}
{% assign diff = now | minus: created %}
{% assign thirty_days = 2592000 %}
{% if diff < thirty_days %}
  {% assign show_new = true %}
{% endif %}

<style>
  .sz-badges {
    position: absolute;
    top: 10px;
    left: 10px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    z-index: 10;
  }

  .sz-badge {
    display: inline-block;
    padding: 5px 10px;
    font-family: "Montserrat", sans-serif;
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    border-radius: 4px;
    line-height: 1;
  }

  .sz-badge--sale {
    background: #C17F24;
    color: #ffffff;
  }

  .sz-badge--bestseller {
    background: #fb5887;
    color: #ffffff;
  }

  .sz-badge--low-stock {
    background: #DC2626;
    color: #ffffff;
    animation: sz-pulse-badge 2s ease infinite;
  }

  .sz-badge--new {
    background: #fe8c43;
    color: #1a1a1a;
  }

  @keyframes sz-pulse-badge {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; }
  }
</style>

{% if show_sale or show_bestseller or show_low_stock or show_new %}
<div class="sz-badges">
  {% if show_sale %}
    <span class="sz-badge sz-badge--sale">{{ discount }}% Off</span>
  {% endif %}

  {% if show_bestseller %}
    <span class="sz-badge sz-badge--bestseller">Bestseller</span>
  {% endif %}

  {% if show_low_stock %}
    <span class="sz-badge sz-badge--low-stock">Only {{ stock_count }} Left</span>
  {% endif %}

  {% if show_new and show_sale == false and show_bestseller == false %}
    <span class="sz-badge sz-badge--new">New</span>
  {% endif %}
</div>
{% endif %}
