{% comment %}
================================================================================
SHELZY'S DESIGNS - SMART PRODUCT BADGES
Version: 2.0.0
Last Updated: 2024-12
================================================================================
Data-driven product badges for merchandising.
Badges are determined by: tags, metafields, availability, price.

Revenue Impact: Visual cues drive urgency and confidence.
Best Seller and Great Gift badges increase click-through by 15-25%.

Usage: {% render 'product-badges-smart', product: product %}
================================================================================
{% endcomment %}

{%- liquid
  assign show_badges = true
  assign badges_count = 0
  assign max_badges = 2

  assign is_sold_out = false
  assign is_on_sale = false
  assign is_bestseller = false
  assign is_great_gift = false
  assign is_personalized = false
  assign is_new = false
  assign is_limited = false
  assign is_popular = false

  unless product.available
    assign is_sold_out = true
    assign badges_count = badges_count | plus: 1
  endunless

  if product.compare_at_price > product.price and product.available
    assign is_on_sale = true
    assign badges_count = badges_count | plus: 1
    assign savings_percent = product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round
  endif

  assign product_tags_lower = product.tags | join: ',' | downcase

  if product_tags_lower contains 'bestseller' or product_tags_lower contains 'best-seller' or product_tags_lower contains 'best seller'
    assign is_bestseller = true
  endif

  if product_tags_lower contains 'great-gift' or product_tags_lower contains 'gift' or product_tags_lower contains 'giftable'
    assign is_great_gift = true
  endif

  if product_tags_lower contains 'personalized' or product_tags_lower contains 'customizable' or product_tags_lower contains 'custom'
    assign is_personalized = true
  endif

  if product_tags_lower contains 'new' or product_tags_lower contains 'new-arrival'
    assign is_new = true
  endif

  if product_tags_lower contains 'limited' or product_tags_lower contains 'limited-edition'
    assign is_limited = true
  endif

  if product_tags_lower contains 'popular' or product_tags_lower contains 'trending'
    assign is_popular = true
  endif

  comment
    Also check metafields for badge overrides
  endcomment
  if product.metafields.custom.badge != blank
    assign custom_badge = product.metafields.custom.badge
  endif
-%}

{%- if show_badges -%}
  <div class="sz-badges">
    {%- comment -%} Custom metafield badge takes priority {%- endcomment -%}
    {%- if custom_badge != blank -%}
      <span class="sz-badge sz-badge--custom">{{ custom_badge }}</span>

    {%- comment -%} Status badges (sold out, sale) {%- endcomment -%}
    {%- elsif is_sold_out -%}
      <span class="sz-badge sz-badge--soldout">Sold Out</span>

    {%- elsif is_on_sale -%}
      <span class="sz-badge sz-badge--sale">
        {%- if savings_percent >= 10 -%}
          {{ savings_percent }}% Off
        {%- else -%}
          Sale
        {%- endif -%}
      </span>

      {%- comment -%} Can show secondary badge with sale {%- endcomment -%}
      {%- if is_bestseller and badges_count < max_badges -%}
        <span class="sz-badge sz-badge--bestseller">Best Seller</span>
      {%- elsif is_limited and badges_count < max_badges -%}
        <span class="sz-badge sz-badge--limited">Limited</span>
      {%- endif -%}

    {%- comment -%} Merchandising badges when not on sale {%- endcomment -%}
    {%- else -%}
      {%- if is_bestseller -%}
        <span class="sz-badge sz-badge--bestseller">Best Seller</span>
      {%- elsif is_new -%}
        <span class="sz-badge sz-badge--new">New</span>
      {%- elsif is_great_gift -%}
        <span class="sz-badge sz-badge--gift">Great Gift</span>
      {%- elsif is_limited -%}
        <span class="sz-badge sz-badge--limited">Limited</span>
      {%- elsif is_popular -%}
        <span class="sz-badge sz-badge--popular">Popular</span>
      {%- endif -%}
    {%- endif -%}
  </div>
{%- endif -%}

<style>
  .sz-badges {
    position: absolute;
    top: var(--sz-space-sm, 12px);
    left: var(--sz-space-sm, 12px);
    display: flex;
    flex-direction: column;
    gap: var(--sz-space-xs, 6px);
    z-index: 2;
  }

  .sz-badge {
    display: inline-block;
    font-family: var(--sz-font-body);
    font-size: 11px;
    font-weight: var(--sz-font-semibold, 600);
    text-transform: uppercase;
    letter-spacing: 0.03em;
    padding: 5px 10px;
    border-radius: var(--sz-radius-sm, 4px);
    line-height: 1;
    white-space: nowrap;
  }

  .sz-badge--soldout {
    background: var(--sz-heading, #1F1F1F);
    color: var(--sz-background, #FFFFFF);
  }

  .sz-badge--sale {
    background: var(--sz-sale, #C41E3A);
    color: var(--sz-background, #FFFFFF);
  }

  .sz-badge--bestseller {
    background: var(--sz-accent, #D4AF37);
    color: var(--sz-heading, #1F1F1F);
  }

  .sz-badge--new {
    background: var(--sz-primary, #8BAA88);
    color: var(--sz-background, #FFFFFF);
  }

  .sz-badge--gift {
    background: #E8A4C4;
    color: var(--sz-heading, #1F1F1F);
  }

  .sz-badge--limited {
    background: var(--sz-heading, #1F1F1F);
    color: var(--sz-accent, #D4AF37);
  }

  .sz-badge--popular {
    background: var(--sz-primary-dark, #4E5F4A);
    color: var(--sz-background, #FFFFFF);
  }

  .sz-badge--custom {
    background: var(--sz-primary, #8BAA88);
    color: var(--sz-background, #FFFFFF);
  }

  /* Personalized indicator - subtle line below badges */
  .sz-badge--personalized {
    background: transparent;
    color: var(--sz-primary-dark);
    border: 1px solid var(--sz-primary);
    padding: 4px 8px;
    font-size: 10px;
  }
</style>
