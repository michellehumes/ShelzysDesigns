{% comment %}
================================================================================
SHELZY'S DESIGNS - FEATURED COLLECTION SECTION
Version: 2.0.0
Last Updated: 2024-12
================================================================================
Display products from a selected collection in a responsive grid.

Features:
- Collection picker
- Configurable product count and columns
- Product badges (sale, sold out, bestseller, new)
- Secondary image on hover
- Quick add button
- Rating display from metafields
- Color scheme support
- Responsive grid
================================================================================
{% endcomment %}

{%- liquid
  assign collection = collections[section.settings.collection]
  assign color_scheme = section.settings.color_scheme

  case color_scheme
    when 'light'
      assign bg_color = 'var(--sz-background)'
      assign text_color = 'var(--sz-text)'
      assign heading_color = 'var(--sz-heading)'
    when 'alt'
      assign bg_color = 'var(--sz-background-alt)'
      assign text_color = 'var(--sz-text)'
      assign heading_color = 'var(--sz-heading)'
    when 'surface'
      assign bg_color = 'var(--sz-surface)'
      assign text_color = 'var(--sz-text)'
      assign heading_color = 'var(--sz-heading)'
    when 'dark'
      assign bg_color = 'var(--sz-primary-dark)'
      assign text_color = 'var(--sz-background)'
      assign heading_color = 'var(--sz-background)'
  endcase
-%}

<section
  class="sz-featured-collection"
  style="
    --section-bg: {{ bg_color }};
    --section-text: {{ text_color }};
    --section-heading: {{ heading_color }};
    --section-padding-top: {{ section.settings.padding_top }}px;
    --section-padding-bottom: {{ section.settings.padding_bottom }}px;
  "
>
  <div class="sz-featured-collection__container">

    {%- if section.settings.heading != blank or section.settings.subheading != blank -%}
      <div class="sz-featured-collection__header sz-featured-collection__header--{{ section.settings.header_alignment }}">
        {%- if section.settings.subheading != blank -%}
          <p class="sz-featured-collection__subheading">{{ section.settings.subheading }}</p>
        {%- endif -%}
        {%- if section.settings.heading != blank -%}
          <h2 class="sz-featured-collection__heading">{{ section.settings.heading }}</h2>
        {%- endif -%}
        {%- if section.settings.description != blank -%}
          <p class="sz-featured-collection__description">{{ section.settings.description }}</p>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="sz-featured-collection__grid sz-featured-collection__grid--{{ section.settings.columns }}">
      {%- for product in collection.products limit: section.settings.products_to_show -%}
        <div class="sz-product-card" data-product-handle="{{ product.handle }}">
          <a href="{{ product.url }}" class="sz-product-card__link" aria-label="{{ product.title }}">
            <div class="sz-product-card__media">
              {%- if product.featured_image != blank -%}
                <img
                  src="{{ product.featured_image | image_url: width: 600 }}"
                  srcset="{{ product.featured_image | image_url: width: 300 }} 300w,
                          {{ product.featured_image | image_url: width: 400 }} 400w,
                          {{ product.featured_image | image_url: width: 500 }} 500w,
                          {{ product.featured_image | image_url: width: 600 }} 600w"
                  sizes="(min-width: 1200px) 300px, (min-width: 768px) 33vw, 50vw"
                  alt="{{ product.featured_image.alt | escape | default: product.title }}"
                  loading="lazy"
                  width="600"
                  height="{{ 600 | divided_by: product.featured_image.aspect_ratio | default: 600 | round }}"
                  class="sz-product-card__image sz-product-card__image--primary"
                >
                {%- if product.images.size > 1 and section.settings.show_secondary_image -%}
                  <img
                    src="{{ product.images[1] | image_url: width: 600 }}"
                    srcset="{{ product.images[1] | image_url: width: 300 }} 300w,
                            {{ product.images[1] | image_url: width: 400 }} 400w,
                            {{ product.images[1] | image_url: width: 500 }} 500w,
                            {{ product.images[1] | image_url: width: 600 }} 600w"
                    sizes="(min-width: 1200px) 300px, (min-width: 768px) 33vw, 50vw"
                    alt="{{ product.images[1].alt | escape | default: product.title }}"
                    loading="lazy"
                    class="sz-product-card__image sz-product-card__image--secondary"
                  >
                {%- endif -%}
              {%- else -%}
                <div class="sz-product-card__placeholder" role="img" aria-label="No image available">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" aria-hidden="true">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5"/>
                    <polyline points="21 15 16 10 5 21"/>
                  </svg>
                </div>
              {%- endif -%}

              {%- comment -%} Badges {%- endcomment -%}
              {%- if section.settings.show_badges -%}
                <div class="sz-product-card__badges">
                  {%- if product.available == false -%}
                    <span class="sz-badge sz-badge--soldout">Sold Out</span>
                  {%- elsif product.compare_at_price > product.price -%}
                    {%- assign savings = product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round -%}
                    <span class="sz-badge sz-badge--sale">{{ savings }}% Off</span>
                  {%- endif -%}
                  {%- if product.tags contains 'bestseller' -%}
                    <span class="sz-badge sz-badge--bestseller">Best Seller</span>
                  {%- endif -%}
                  {%- if product.tags contains 'new' -%}
                    <span class="sz-badge sz-badge--new">New</span>
                  {%- endif -%}
                </div>
              {%- endif -%}

              {%- comment -%} Quick Add {%- endcomment -%}
              {%- if section.settings.show_quick_add and product.available -%}
                <div class="sz-product-card__quick-add">
                  <button
                    type="button"
                    class="sz-product-card__quick-btn"
                    data-product-handle="{{ product.handle }}"
                    data-variant-id="{{ product.selected_or_first_available_variant.id }}"
                    aria-label="Quick add {{ product.title }} to cart"
                  >
                    Quick Add
                  </button>
                </div>
              {%- endif -%}
            </div>

            <div class="sz-product-card__info sz-product-card__info--{{ section.settings.text_alignment }}">
              {%- if section.settings.show_vendor and product.vendor != blank -%}
                <p class="sz-product-card__vendor">{{ product.vendor }}</p>
              {%- endif -%}

              <h3 class="sz-product-card__title">{{ product.title }}</h3>

              <div class="sz-product-card__price">
                {%- if product.compare_at_price > product.price -%}
                  <span class="sz-price sz-price--sale">{{ product.price | money }}</span>
                  <span class="sz-price sz-price--compare">{{ product.compare_at_price | money }}</span>
                {%- else -%}
                  <span class="sz-price">{{ product.price | money }}</span>
                {%- endif -%}
              </div>

              {%- if section.settings.show_rating and product.metafields.reviews.rating.value != blank -%}
                {%- assign rating = product.metafields.reviews.rating.value | round: 1 -%}
                <div class="sz-product-card__rating">
                  <div class="sz-stars" style="--rating: {{ rating }};" aria-label="{{ rating }} out of 5 stars">
                    <span aria-hidden="true">★★★★★</span>
                  </div>
                  {%- if product.metafields.reviews.rating_count.value != blank -%}
                    <span class="sz-rating-count">({{ product.metafields.reviews.rating_count.value }})</span>
                  {%- endif -%}
                </div>
              {%- endif -%}
            </div>
          </a>
        </div>
      {%- else -%}
        {%- comment -%} Placeholder cards when no collection selected {%- endcomment -%}
        {%- for i in (1..section.settings.products_to_show) -%}
          <div class="sz-product-card sz-product-card--placeholder">
            <div class="sz-product-card__media">
              <div class="sz-product-card__placeholder" role="img" aria-label="Placeholder product">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" aria-hidden="true">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                  <circle cx="8.5" cy="8.5" r="1.5"/>
                  <polyline points="21 15 16 10 5 21"/>
                </svg>
              </div>
            </div>
            <div class="sz-product-card__info">
              <h3 class="sz-product-card__title">Product Title</h3>
              <div class="sz-product-card__price">
                <span class="sz-price">$0.00</span>
              </div>
            </div>
          </div>
        {%- endfor -%}
      {%- endfor -%}
    </div>

    {%- if section.settings.show_view_all and collection != blank -%}
      <div class="sz-featured-collection__footer">
        <a href="{{ collection.url }}" class="sz-featured-collection__view-all">
          {{ section.settings.view_all_text | default: 'View All Products' }}
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </a>
      </div>
    {%- endif -%}

  </div>
</section>

{% style %}
  .sz-featured-collection {
    background-color: var(--section-bg);
    padding-top: var(--section-padding-top);
    padding-bottom: var(--section-padding-bottom);
  }

  .sz-featured-collection__container {
    max-width: var(--sz-container-max, 1400px);
    margin: 0 auto;
    padding: 0 var(--sz-container-padding, 24px);
  }

  .sz-featured-collection__header {
    margin-bottom: var(--sz-space-2xl, 48px);
  }

  .sz-featured-collection__header--center {
    text-align: center;
  }

  .sz-featured-collection__header--left {
    text-align: left;
  }

  .sz-featured-collection__header--right {
    text-align: right;
  }

  .sz-featured-collection__subheading {
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-xs, 13px);
    font-weight: var(--sz-font-semibold, 600);
    text-transform: uppercase;
    letter-spacing: 0.15em;
    margin: 0 0 var(--sz-space-sm, 12px) 0;
    color: var(--sz-primary);
  }

  .sz-featured-collection__heading {
    font-family: var(--sz-font-heading);
    font-size: var(--sz-text-4xl, clamp(28px, 4vw, 42px));
    font-weight: var(--sz-font-heading-weight, 500);
    margin: 0 0 var(--sz-space-md, 16px) 0;
    color: var(--section-heading);
  }

  .sz-featured-collection__description {
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-base, 16px);
    line-height: var(--sz-leading-relaxed, 1.6);
    max-width: 600px;
    margin: 0 auto;
    opacity: 0.8;
    color: var(--section-text);
  }

  .sz-featured-collection__header--left .sz-featured-collection__description,
  .sz-featured-collection__header--right .sz-featured-collection__description {
    margin: 0;
  }

  .sz-featured-collection__grid {
    display: grid;
    gap: var(--sz-space-lg, 24px);
  }

  .sz-featured-collection__grid--2 { grid-template-columns: repeat(2, 1fr); }
  .sz-featured-collection__grid--3 { grid-template-columns: repeat(3, 1fr); }
  .sz-featured-collection__grid--4 { grid-template-columns: repeat(4, 1fr); }
  .sz-featured-collection__grid--5 { grid-template-columns: repeat(5, 1fr); }

  @media (max-width: 1024px) {
    .sz-featured-collection__grid--4,
    .sz-featured-collection__grid--5 { grid-template-columns: repeat(3, 1fr); }
  }

  @media (max-width: 768px) {
    .sz-featured-collection__grid--3,
    .sz-featured-collection__grid--4,
    .sz-featured-collection__grid--5 { grid-template-columns: repeat(2, 1fr); }
  }

  @media (max-width: 480px) {
    .sz-featured-collection__grid { gap: var(--sz-space-md, 16px); }
  }

  /* Product Card Styles */
  .sz-product-card {
    position: relative;
  }

  .sz-product-card__link {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  .sz-product-card__media {
    position: relative;
    aspect-ratio: 1;
    overflow: hidden;
    background: var(--sz-surface, #F5F2ED);
    border-radius: var(--sz-radius-lg, 12px);
    margin-bottom: var(--sz-space-md, 16px);
  }

  .sz-product-card__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform var(--sz-transition-normal, 0.4s) ease, opacity var(--sz-transition-normal, 0.4s) ease;
  }

  .sz-product-card__image--secondary {
    position: absolute;
    top: 0;
    left: 0;
    opacity: 0;
  }

  .sz-product-card:hover .sz-product-card__image--primary {
    transform: scale(1.05);
  }

  .sz-product-card:hover .sz-product-card__image--secondary {
    opacity: 1;
  }

  .sz-product-card__placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--sz-text-muted, #CCCCCC);
  }

  .sz-product-card__badges {
    position: absolute;
    top: var(--sz-space-sm, 12px);
    left: var(--sz-space-sm, 12px);
    display: flex;
    flex-direction: column;
    gap: var(--sz-space-xs, 6px);
    z-index: 2;
  }

  .sz-badge {
    font-family: var(--sz-font-body);
    font-size: 11px;
    font-weight: var(--sz-font-semibold, 600);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 6px 10px;
    border-radius: var(--sz-radius-sm, 4px);
  }

  .sz-badge--sale { background: var(--sz-sale, #C41E3A); color: #FFFFFF; }
  .sz-badge--soldout { background: var(--sz-heading, #1F1F1F); color: #FFFFFF; }
  .sz-badge--bestseller { background: var(--sz-accent, #D4AF37); color: var(--sz-heading, #1F1F1F); }
  .sz-badge--new { background: var(--sz-primary, #8BAA88); color: #FFFFFF; }

  .sz-product-card__quick-add {
    position: absolute;
    bottom: var(--sz-space-sm, 12px);
    left: var(--sz-space-sm, 12px);
    right: var(--sz-space-sm, 12px);
    opacity: 0;
    transform: translateY(10px);
    transition: all var(--sz-transition-normal, 0.3s) ease;
    z-index: 2;
  }

  .sz-product-card:hover .sz-product-card__quick-add {
    opacity: 1;
    transform: translateY(0);
  }

  .sz-product-card__quick-btn {
    width: 100%;
    padding: var(--sz-space-sm, 12px);
    background: var(--sz-background, #FFFFFF);
    border: none;
    border-radius: var(--sz-radius-md, 8px);
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-sm, 13px);
    font-weight: var(--sz-font-semibold, 600);
    color: var(--sz-text);
    cursor: pointer;
    transition: background var(--sz-transition-fast, 0.2s) ease;
  }

  .sz-product-card__quick-btn:hover {
    background: var(--sz-surface, #F5F2ED);
  }

  .sz-product-card__info {
    display: flex;
    flex-direction: column;
    gap: var(--sz-space-xs, 4px);
  }

  .sz-product-card__info--center {
    text-align: center;
    align-items: center;
  }

  .sz-product-card__info--left {
    text-align: left;
    align-items: flex-start;
  }

  .sz-product-card__vendor {
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-xs, 12px);
    color: var(--sz-text-muted, #7A7A7A);
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .sz-product-card__title {
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-sm, 15px);
    font-weight: var(--sz-font-medium, 500);
    color: var(--section-text, var(--sz-text));
    margin: 0;
    line-height: var(--sz-leading-snug, 1.4);
  }

  .sz-product-card__price {
    display: flex;
    gap: var(--sz-space-sm, 8px);
    align-items: center;
  }

  .sz-price {
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-sm, 15px);
    font-weight: var(--sz-font-semibold, 600);
    color: var(--section-text, var(--sz-text));
  }

  .sz-price--sale { color: var(--sz-sale, #C41E3A); }

  .sz-price--compare {
    font-weight: var(--sz-font-normal, 400);
    color: var(--sz-text-muted, #7A7A7A);
    text-decoration: line-through;
    font-size: var(--sz-text-xs, 14px);
  }

  .sz-product-card__rating {
    display: flex;
    gap: var(--sz-space-xs, 6px);
    align-items: center;
    margin-top: var(--sz-space-xs, 4px);
  }

  .sz-stars {
    font-size: var(--sz-text-sm, 14px);
    color: var(--sz-accent, #D4AF37);
    background: linear-gradient(90deg, var(--sz-accent, #D4AF37) calc(var(--rating) / 5 * 100%), var(--sz-border, #E0E0E0) calc(var(--rating) / 5 * 100%));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .sz-rating-count {
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-xs, 12px);
    color: var(--sz-text-muted, #7A7A7A);
  }

  .sz-featured-collection__footer {
    text-align: center;
    margin-top: var(--sz-space-2xl, 48px);
  }

  .sz-featured-collection__view-all {
    display: inline-flex;
    align-items: center;
    gap: var(--sz-space-sm, 8px);
    padding: var(--sz-space-md, 16px) var(--sz-space-xl, 40px);
    background: var(--sz-primary);
    color: var(--sz-background, #FFFFFF);
    font-family: var(--sz-font-body);
    font-size: var(--sz-text-sm, 14px);
    font-weight: var(--sz-font-semibold, 600);
    text-decoration: none;
    border-radius: var(--sz-radius-button, 8px);
    transition: all var(--sz-transition-normal, 0.3s) ease;
  }

  .sz-featured-collection__view-all:hover {
    background: var(--sz-primary-dark);
    transform: translateY(-2px);
    box-shadow: var(--sz-shadow-md);
  }

  .sz-featured-collection__view-all svg {
    transition: transform var(--sz-transition-fast, 0.2s) ease;
  }

  .sz-featured-collection__view-all:hover svg {
    transform: translateX(4px);
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .sz-product-card__image,
    .sz-product-card__quick-add,
    .sz-featured-collection__view-all,
    .sz-featured-collection__view-all svg {
      transition: none;
    }

    .sz-product-card:hover .sz-product-card__image--primary {
      transform: none;
    }

    .sz-featured-collection__view-all:hover {
      transform: none;
    }
  }
{% endstyle %}

{% schema %}
{
  "name": "Featured Collection",
  "tag": "section",
  "class": "sz-section-featured-collection",
  "settings": [
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "label": "Products to show",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 4
    },
    {
      "type": "select",
      "id": "columns",
      "label": "Columns",
      "options": [
        { "value": "2", "label": "2" },
        { "value": "3", "label": "3" },
        { "value": "4", "label": "4" },
        { "value": "5", "label": "5" }
      ],
      "default": "4"
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Color scheme",
      "options": [
        { "value": "light", "label": "Light" },
        { "value": "alt", "label": "Alternate" },
        { "value": "surface", "label": "Surface" },
        { "value": "dark", "label": "Dark" }
      ],
      "default": "light"
    },
    {
      "type": "header",
      "content": "Header"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Shop Our Collection"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Best Sellers"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "select",
      "id": "header_alignment",
      "label": "Header alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "Product Cards"
    },
    {
      "type": "checkbox",
      "id": "show_secondary_image",
      "label": "Show second image on hover",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_badges",
      "label": "Show product badges",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show vendor",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "label": "Show rating",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_quick_add",
      "label": "Show quick add button",
      "default": true
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" }
      ],
      "default": "left"
    },
    {
      "type": "header",
      "content": "View All Button"
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show 'View All' button",
      "default": true
    },
    {
      "type": "text",
      "id": "view_all_text",
      "label": "Button text",
      "default": "View All Products"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Top padding",
      "min": 0,
      "max": 120,
      "step": 8,
      "default": 80,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Bottom padding",
      "min": 0,
      "max": 120,
      "step": 8,
      "default": 80,
      "unit": "px"
    }
  ],
  "presets": [
    {
      "name": "Featured Collection",
      "settings": {
        "subheading": "Shop Our Collection",
        "heading": "Best Sellers"
      }
    }
  ]
}
{% endschema %}
