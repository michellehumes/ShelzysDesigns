{%- comment -%}
  Shelzy's Designs - Clean Collection Page
  Simplified, organized collection layout with consistent spacing
{%- endcomment -%}

{%- comment -%} Collection Schema for SEO {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "{{ collection.title | escape }}",
  "description": "{{ collection.description | strip_html | escape | truncate: 160 }}",
  "url": "{{ shop.url }}{{ collection.url }}"
}
</script>

<div class="sz-collection">
  {%- comment -%} Clean Header {%- endcomment -%}
  <header class="sz-collection-header">
    <div class="sz-collection-header-content">
      <h1 class="sz-collection-title">{{ collection.title }}</h1>
      {%- if collection.description != blank and section.settings.show_description -%}
        <p class="sz-collection-desc">{{ collection.description | strip_html | truncate: 200 }}</p>
      {%- endif -%}
    </div>
  </header>

  <div class="sz-collection-main">
    {%- comment -%} Toolbar {%- endcomment -%}
    <div class="sz-toolbar">
      <span class="sz-toolbar-count">
        {{ collection.products_count }} {{ collection.products_count | pluralize: 'product', 'products' }}
      </span>

      <div class="sz-toolbar-actions">
        <div class="sz-sort">
          <label for="sort-select" class="sz-sort-label">Sort:</label>
          <select id="sort-select" class="sz-sort-select" onchange="window.location.href = this.value;">
            {%- assign sort_options = 'manual|best-selling|title-ascending|price-ascending|price-descending|created-descending' | split: '|' -%}
            {%- assign sort_labels = 'Featured|Best Selling|A-Z|Price: Low to High|Price: High to Low|Newest' | split: '|' -%}
            {%- for option in sort_options -%}
              <option value="{{ collection.url }}?sort_by={{ option }}" {% if collection.sort_by == option or collection.default_sort_by == option and collection.sort_by == blank %}selected{% endif %}>
                {{ sort_labels[forloop.index0] }}
              </option>
            {%- endfor -%}
          </select>
        </div>
      </div>
    </div>

    {%- comment -%} Products Grid {%- endcomment -%}
    {%- if collection.products.size > 0 -%}
      {%- paginate collection.products by section.settings.products_per_page -%}

        <div class="sz-products" data-columns="{{ section.settings.columns }}">
          {%- for product in collection.products -%}
            <article class="sz-product-card">
              <a href="{{ product.url | within: collection }}" class="sz-product-link">
                {%- comment -%} Image {%- endcomment -%}
                <div class="sz-product-media">
                  {%- if product.featured_image -%}
                    <img
                      src="{{ product.featured_image | image_url: width: 480 }}"
                      srcset="{{ product.featured_image | image_url: width: 320 }} 320w,
                              {{ product.featured_image | image_url: width: 480 }} 480w,
                              {{ product.featured_image | image_url: width: 640 }} 640w"
                      sizes="(max-width: 480px) 50vw, (max-width: 768px) 33vw, 25vw"
                      alt="{{ product.featured_image.alt | default: product.title | escape }}"
                      loading="lazy"
                      class="sz-product-image"
                    >
                    {%- if product.images.size > 1 and section.settings.show_secondary_image -%}
                      <img
                        src="{{ product.images[1] | image_url: width: 480 }}"
                        alt="{{ product.images[1].alt | default: product.title | escape }}"
                        loading="lazy"
                        class="sz-product-image sz-product-image--hover"
                      >
                    {%- endif -%}
                  {%- else -%}
                    <div class="sz-product-placeholder">
                      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <circle cx="8.5" cy="8.5" r="1.5"/>
                        <polyline points="21 15 16 10 5 21"/>
                      </svg>
                    </div>
                  {%- endif -%}

                  {%- comment -%} Badges {%- endcomment -%}
                  {%- if product.available == false -%}
                    <span class="sz-badge sz-badge--soldout">Sold Out</span>
                  {%- elsif product.compare_at_price > product.price -%}
                    <span class="sz-badge sz-badge--sale">Sale</span>
                  {%- endif -%}
                </div>

                {%- comment -%} Info {%- endcomment -%}
                <div class="sz-product-info">
                  <h2 class="sz-product-title">{{ product.title }}</h2>
                  <div class="sz-product-price">
                    {%- if product.compare_at_price > product.price -%}
                      <span class="sz-price--compare">{{ product.compare_at_price | money }}</span>
                    {%- endif -%}
                    <span class="sz-price--current {% if product.compare_at_price > product.price %}sz-price--sale{% endif %}">
                      {{ product.price | money }}
                    </span>
                  </div>
                </div>
              </a>
            </article>
          {%- endfor -%}
        </div>

        {%- comment -%} Pagination {%- endcomment -%}
        {%- if paginate.pages > 1 -%}
          <nav class="sz-pagination" aria-label="Pagination">
            {%- if paginate.previous -%}
              <a href="{{ paginate.previous.url }}" class="sz-pagination-btn sz-pagination-prev">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
                Previous
              </a>
            {%- endif -%}

            <div class="sz-pagination-pages">
              {%- for part in paginate.parts -%}
                {%- if part.is_link -%}
                  <a href="{{ part.url }}" class="sz-pagination-page">{{ part.title }}</a>
                {%- else -%}
                  {%- if part.title == paginate.current_page -%}
                    <span class="sz-pagination-page sz-pagination-current" aria-current="page">{{ part.title }}</span>
                  {%- else -%}
                    <span class="sz-pagination-ellipsis">{{ part.title }}</span>
                  {%- endif -%}
                {%- endif -%}
              {%- endfor -%}
            </div>

            {%- if paginate.next -%}
              <a href="{{ paginate.next.url }}" class="sz-pagination-btn sz-pagination-next">
                Next
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
              </a>
            {%- endif -%}
          </nav>
        {%- endif -%}

      {%- endpaginate -%}

    {%- else -%}
      <div class="sz-empty">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <circle cx="11" cy="11" r="8"/>
          <line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        <p>No products found in this collection.</p>
        <a href="/collections/all" class="sz-btn">Browse All Products</a>
      </div>
    {%- endif -%}
  </div>
</div>

<style>
  /* ==========================================
     COLLECTION PAGE - CLEAN & ORGANIZED
     ========================================== */

  .sz-collection {
    background: #fff;
    min-height: 60vh;
  }

  /* Header */
  .sz-collection-header {
    background: var(--sz-beige, #F5F2ED);
    padding: 48px 24px;
    text-align: center;
  }

  .sz-collection-header-content {
    max-width: 680px;
    margin: 0 auto;
  }

  .sz-collection-title {
    font-family: var(--sz-font-heading);
    font-size: clamp(1.75rem, 4vw, 2.5rem);
    font-weight: 500;
    color: var(--sz-charcoal, #1F1F1F);
    margin: 0 0 12px;
    letter-spacing: -0.02em;
  }

  .sz-collection-desc {
    font-family: var(--sz-font-body);
    font-size: 15px;
    color: var(--sz-gray, #6B7280);
    line-height: 1.6;
    margin: 0;
  }

  /* Main Container */
  .sz-collection-main {
    max-width: 1280px;
    margin: 0 auto;
    padding: 32px 24px 64px;
  }

  /* Toolbar */
  .sz-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 24px;
    margin-bottom: 24px;
    border-bottom: 1px solid var(--sz-border-light, #E8E4DE);
  }

  .sz-toolbar-count {
    font-family: var(--sz-font-body);
    font-size: 14px;
    color: var(--sz-gray, #6B7280);
  }

  .sz-sort {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .sz-sort-label {
    font-family: var(--sz-font-body);
    font-size: 14px;
    color: var(--sz-charcoal, #1F1F1F);
    font-weight: 500;
  }

  .sz-sort-select {
    font-family: var(--sz-font-body);
    font-size: 14px;
    padding: 8px 32px 8px 12px;
    border: 1px solid var(--sz-border-light, #E8E4DE);
    border-radius: 6px;
    background: #fff url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%236B7280' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E") no-repeat right 10px center;
    appearance: none;
    cursor: pointer;
    transition: border-color 0.2s;
  }

  .sz-sort-select:hover {
    border-color: var(--sz-primary, #8BAA88);
  }

  .sz-sort-select:focus {
    outline: none;
    border-color: var(--sz-primary, #8BAA88);
    box-shadow: 0 0 0 3px rgba(139, 170, 136, 0.1);
  }

  /* Products Grid */
  .sz-products {
    display: grid;
    gap: 24px;
  }

  .sz-products[data-columns="4"] {
    grid-template-columns: repeat(4, 1fr);
  }

  .sz-products[data-columns="3"] {
    grid-template-columns: repeat(3, 1fr);
  }

  @media (max-width: 1024px) {
    .sz-products[data-columns="4"],
    .sz-products[data-columns="3"] {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (max-width: 768px) {
    .sz-products {
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }

    .sz-collection-main {
      padding: 24px 16px 48px;
    }

    .sz-collection-header {
      padding: 32px 16px;
    }
  }

  /* Product Card */
  .sz-product-card {
    position: relative;
  }

  .sz-product-link {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  .sz-product-media {
    position: relative;
    aspect-ratio: 1;
    overflow: hidden;
    border-radius: 12px;
    background: var(--sz-beige, #F5F2ED);
    margin-bottom: 12px;
  }

  .sz-product-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: opacity 0.4s ease;
  }

  .sz-product-image--hover {
    position: absolute;
    inset: 0;
    opacity: 0;
  }

  .sz-product-link:hover .sz-product-image--hover {
    opacity: 1;
  }

  .sz-product-link:hover .sz-product-image:not(.sz-product-image--hover) {
    opacity: 0;
  }

  .sz-product-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--sz-gray, #6B7280);
  }

  /* Badges */
  .sz-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    font-family: var(--sz-font-body);
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 5px 10px;
    border-radius: 4px;
  }

  .sz-badge--sale {
    background: var(--sz-primary-dark, #4E5F4A);
    color: #fff;
  }

  .sz-badge--soldout {
    background: var(--sz-charcoal, #1F1F1F);
    color: #fff;
  }

  /* Product Info */
  .sz-product-info {
    padding: 0 4px;
  }

  .sz-product-title {
    font-family: var(--sz-font-body);
    font-size: 14px;
    font-weight: 500;
    color: var(--sz-charcoal, #1F1F1F);
    margin: 0 0 4px;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .sz-product-price {
    display: flex;
    align-items: center;
    gap: 8px;
    font-family: var(--sz-font-body);
  }

  .sz-price--current {
    font-size: 15px;
    font-weight: 600;
    color: var(--sz-charcoal, #1F1F1F);
  }

  .sz-price--current.sz-price--sale {
    color: var(--sz-primary-dark, #4E5F4A);
  }

  .sz-price--compare {
    font-size: 13px;
    color: var(--sz-gray, #6B7280);
    text-decoration: line-through;
  }

  /* Pagination */
  .sz-pagination {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-top: 48px;
    padding-top: 32px;
    border-top: 1px solid var(--sz-border-light, #E8E4DE);
  }

  .sz-pagination-pages {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .sz-pagination-btn,
  .sz-pagination-page {
    font-family: var(--sz-font-body);
    font-size: 14px;
    font-weight: 500;
    color: var(--sz-charcoal, #1F1F1F);
    text-decoration: none;
    padding: 8px 12px;
    border-radius: 6px;
    transition: background 0.2s, color 0.2s;
  }

  .sz-pagination-btn {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .sz-pagination-btn:hover,
  .sz-pagination-page:hover {
    background: var(--sz-beige, #F5F2ED);
  }

  .sz-pagination-current {
    background: var(--sz-primary-dark, #4E5F4A);
    color: #fff;
  }

  .sz-pagination-current:hover {
    background: var(--sz-primary-dark, #4E5F4A);
    color: #fff;
  }

  .sz-pagination-ellipsis {
    padding: 8px 4px;
    color: var(--sz-gray, #6B7280);
  }

  @media (max-width: 600px) {
    .sz-pagination-pages {
      display: none;
    }
  }

  /* Empty State */
  .sz-empty {
    text-align: center;
    padding: 64px 24px;
  }

  .sz-empty svg {
    color: var(--sz-gray, #6B7280);
    margin-bottom: 16px;
  }

  .sz-empty p {
    font-family: var(--sz-font-body);
    font-size: 16px;
    color: var(--sz-gray, #6B7280);
    margin: 0 0 24px;
  }

  .sz-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-family: var(--sz-font-body);
    font-size: 14px;
    font-weight: 600;
    color: #fff;
    background: var(--sz-primary-dark, #4E5F4A);
    padding: 12px 24px;
    border-radius: 8px;
    text-decoration: none;
    transition: background 0.2s;
  }

  .sz-btn:hover {
    background: var(--sz-charcoal, #1F1F1F);
  }

  /* Reduced Motion */
  @media (prefers-reduced-motion: reduce) {
    .sz-product-image,
    .sz-sort-select,
    .sz-pagination-btn,
    .sz-pagination-page {
      transition: none;
    }
  }
</style>

{% schema %}
{
  "name": "Collection Page",
  "tag": "section",
  "class": "sz-collection-section",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_description",
      "label": "Show collection description",
      "default": true
    },
    {
      "type": "range",
      "id": "products_per_page",
      "label": "Products per page",
      "min": 8,
      "max": 24,
      "step": 4,
      "default": 16
    },
    {
      "type": "select",
      "id": "columns",
      "label": "Products per row (desktop)",
      "options": [
        {"value": "3", "label": "3"},
        {"value": "4", "label": "4"}
      ],
      "default": "4"
    },
    {
      "type": "checkbox",
      "id": "show_secondary_image",
      "label": "Show second image on hover",
      "default": true
    }
  ]
}
{% endschema %}
