{%- comment -%}
  Cart Drawer Snippet

  Features:
  - Slide-out cart
  - Free shipping progress bar
  - Upsell message
  - Cart items display
  - Checkout button
{%- endcomment -%}

<div class="cart-drawer-overlay"></div>

<aside class="cart-drawer" aria-label="Shopping cart">
  <div class="cart-drawer__header">
    <h2 class="cart-drawer__title">Your Cart</h2>
    <button class="cart-drawer__close" aria-label="Close cart">&times;</button>
  </div>

  <div class="cart-drawer__content">
    {%- comment -%} Free Shipping Bar {%- endcomment -%}
    {%- if settings.enable_free_shipping_bar -%}
      {%- assign threshold = settings.free_shipping_threshold | default: 50 | times: 100 -%}
      {%- assign remaining = threshold | minus: cart.total_price -%}
      {%- assign progress = cart.total_price | times: 100.0 | divided_by: threshold -%}
      {%- if progress > 100 -%}{%- assign progress = 100 -%}{%- endif -%}

      <div class="free-shipping-bar{% if remaining <= 0 %} free-shipping-bar--achieved{% endif %}">
        <p class="free-shipping-bar__message">
          {%- if remaining > 0 -%}
            Add {{ remaining | money }} more to unlock FREE SHIPPING!
          {%- else -%}
            You've unlocked FREE SHIPPING!
          {%- endif -%}
        </p>
        <div class="free-shipping-bar__progress">
          <div class="free-shipping-bar__progress-fill" style="width: {{ progress }}%;"></div>
        </div>
      </div>
    {%- endif -%}

    {%- if cart.item_count > 0 -%}
      <div class="cart-drawer__items">
        {%- for item in cart.items -%}
          <div class="cart-item" data-line="{{ forloop.index }}">
            <a href="{{ item.url }}" class="cart-item__image">
              {%- if item.image -%}
                <img src="{{ item.image | image_url: width: 120 }}" alt="{{ item.title | escape }}">
              {%- else -%}
                {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
              {%- endif -%}
            </a>

            <div class="cart-item__details">
              <h3 class="cart-item__title">
                <a href="{{ item.url }}">{{ item.product.title }}</a>
              </h3>

              {%- if item.variant.title != 'Default Title' -%}
                <p class="cart-item__variant">{{ item.variant.title }}</p>
              {%- endif -%}

              {%- comment -%} Display line item properties (personalization) {%- endcomment -%}
              {%- if item.properties.size > 0 -%}
                <div class="cart-item__properties">
                  {%- for property in item.properties -%}
                    {%- unless property.last == blank -%}
                      <p class="cart-item__property">
                        <span>{{ property.first }}:</span> {{ property.last }}
                      </p>
                    {%- endunless -%}
                  {%- endfor -%}
                </div>
              {%- endif -%}

              <div class="cart-item__footer">
                <div class="cart-item__quantity">
                  <button class="cart-item__qty-btn" data-action="decrease" aria-label="Decrease quantity">-</button>
                  <span class="cart-item__qty-value">{{ item.quantity }}</span>
                  <button class="cart-item__qty-btn" data-action="increase" aria-label="Increase quantity">+</button>
                </div>

                <p class="cart-item__price">{{ item.final_line_price | money }}</p>
              </div>
            </div>

            <button class="cart-item__remove" data-action="remove" aria-label="Remove item">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                <line x1="2" y1="2" x2="14" y2="14"></line>
                <line x1="14" y1="2" x2="2" y2="14"></line>
              </svg>
            </button>
          </div>
        {%- endfor -%}
      </div>
    {%- else -%}
      <div class="cart-drawer__empty">
        <p>Your cart is empty.</p>
        <p>Ready to create something special?</p>
        <a href="/collections/best-sellers" class="btn btn-primary">Shop Best Sellers</a>
      </div>
    {%- endif -%}
  </div>

  {%- if cart.item_count > 0 -%}
    <div class="cart-drawer__footer">
      {%- comment -%} Upsell Message {%- endcomment -%}
      {%- if settings.enable_cart_upsell -%}
        <div class="cart-drawer__upsell">
          <p>{{ settings.upsell_message | default: "Ordering for your bridal party? Check out our multi-packs for bulk savings." }}</p>
        </div>
      {%- endif -%}

      <div class="cart-drawer__total">
        <span>Subtotal</span>
        <span class="cart-drawer__total-amount">{{ cart.total_price | money }}</span>
      </div>

      <form action="/cart" method="post">
        <button type="submit" name="checkout" class="btn btn-primary cart-drawer__checkout">
          Checkout
        </button>
      </form>

      <p class="cart-drawer__shipping-note">Shipping & taxes calculated at checkout</p>
    </div>
  {%- endif -%}
</aside>

<style>
.cart-item {
  display: flex;
  gap: 16px;
  padding: 16px 0;
  border-bottom: 1px solid #F7F4EF;
  position: relative;
}

.cart-item__image {
  flex-shrink: 0;
  width: 80px;
  height: 80px;
  border-radius: 8px;
  overflow: hidden;
  background: #F7F4EF;
}

.cart-item__image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.cart-item__details {
  flex: 1;
  min-width: 0;
}

.cart-item__title {
  font-size: 14px;
  font-weight: 600;
  margin: 0 0 4px;
  line-height: 1.3;
}

.cart-item__title a {
  color: #111111;
  text-decoration: none;
}

.cart-item__variant {
  font-size: 12px;
  color: #666666;
  margin: 0 0 4px;
}

.cart-item__properties {
  margin-bottom: 8px;
}

.cart-item__property {
  font-size: 11px;
  color: #666666;
  margin: 0;
  line-height: 1.4;
}

.cart-item__property span {
  font-weight: 500;
}

.cart-item__footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 8px;
}

.cart-item__quantity {
  display: flex;
  align-items: center;
  gap: 8px;
  background: #F7F4EF;
  border-radius: 4px;
  padding: 4px 8px;
}

.cart-item__qty-btn {
  background: none;
  border: none;
  width: 24px;
  height: 24px;
  font-size: 16px;
  cursor: pointer;
  color: #111111;
}

.cart-item__qty-value {
  font-size: 14px;
  font-weight: 500;
  min-width: 20px;
  text-align: center;
}

.cart-item__price {
  font-size: 14px;
  font-weight: 600;
  margin: 0;
}

.cart-item__remove {
  position: absolute;
  top: 16px;
  right: 0;
  background: none;
  border: none;
  cursor: pointer;
  color: #888888;
  padding: 4px;
}

.cart-item__remove:hover {
  color: #C74B4B;
}

.cart-drawer__empty {
  text-align: center;
  padding: 60px 20px;
}

.cart-drawer__empty p {
  color: #666666;
  margin-bottom: 8px;
}

.cart-drawer__empty .btn {
  margin-top: 16px;
}

.cart-drawer__shipping-note {
  font-size: 12px;
  color: #666666;
  text-align: center;
  margin-top: 12px;
  margin-bottom: 0;
}
</style>
