<!DOCTYPE html>
<html class="no-js" lang="{{ request.locale.iso_code }}">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  {%- comment -%} SEO Meta Tags {%- endcomment -%}
  <title>
    {%- if page_title -%}
      {{ page_title }}
      {%- if current_tags %} &ndash; tagged "{{ current_tags | join: ', ' }}"{% endif -%}
      {%- if current_page != 1 %} &ndash; Page {{ current_page }}{% endif -%}
      {{ settings.seo_title_suffix }}
    {%- else -%}
      Custom Personalized Water Bottles {{ settings.seo_title_suffix }}
    {%- endif -%}
  </title>

  {%- if page_description -%}
    <meta name="description" content="{{ page_description | escape }}">
  {%- else -%}
    <meta name="description" content="{{ settings.seo_default_description | escape }}">
  {%- endif -%}

  <link rel="canonical" href="{{ canonical_url }}">

  {%- if settings.favicon != blank -%}
    <link rel="icon" type="image/png" href="{{ settings.favicon | image_url: width: 32, height: 32 }}">
  {%- endif -%}

  {%- comment -%} Preconnect to important third-party origins {%- endcomment -%}
  <link rel="preconnect" href="https://cdn.shopify.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  {%- comment -%} Google Fonts - Poppins and Inter {%- endcomment -%}
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  {%- comment -%} Theme CSS {%- endcomment -%}
  {{ 'theme.css' | asset_url | stylesheet_tag }}

  {%- comment -%} Open Graph / Social Sharing Meta {%- endcomment -%}
  <meta property="og:site_name" content="{{ shop.name }}">
  <meta property="og:url" content="{{ canonical_url }}">
  <meta property="og:title" content="{{ page_title | default: shop.name }}">
  <meta property="og:type" content="website">
  <meta property="og:description" content="{{ page_description | default: settings.seo_default_description | escape }}">

  {%- if page_image -%}
    <meta property="og:image" content="http:{{ page_image | image_url }}">
    <meta property="og:image:secure_url" content="https:{{ page_image | image_url }}">
    <meta property="og:image:width" content="{{ page_image.width }}">
    <meta property="og:image:height" content="{{ page_image.height }}">
  {%- endif -%}

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ page_title | default: shop.name }}">
  <meta name="twitter:description" content="{{ page_description | default: settings.seo_default_description | escape }}">

  {%- comment -%} Google Analytics 4 {%- endcomment -%}
  {%- if settings.ga4_measurement_id != blank -%}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ settings.ga4_measurement_id }}"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '{{ settings.ga4_measurement_id }}');
    </script>
  {%- endif -%}

  {%- comment -%} Facebook Pixel {%- endcomment -%}
  {%- if settings.facebook_pixel_id != blank -%}
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '{{ settings.facebook_pixel_id }}');
      fbq('track', 'PageView');
    </script>
    <noscript>
      <img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id={{ settings.facebook_pixel_id }}&ev=PageView&noscript=1"/>
    </noscript>
  {%- endif -%}

  {{ content_for_header }}

  {%- comment -%} Data Layer for Analytics {%- endcomment -%}
  <script>
    window.ShelzysConfig = {
      shop: {
        name: {{ shop.name | json }},
        currency: {{ shop.currency | json }},
        moneyFormat: {{ shop.money_format | json }}
      },
      cart: {
        token: {{ cart.token | json }},
        itemCount: {{ cart.item_count }},
        totalPrice: {{ cart.total_price }}
      },
      customer: {
        loggedIn: {{ customer | yepnope: 'true', 'false' }},
        email: {{ customer.email | json }}
      },
      freeShippingThreshold: {{ settings.free_shipping_threshold | default: 50 | times: 100 }}
    };
  </script>
</head>

<body class="template-{{ template.name | handle }}{% if template.suffix %} template-{{ template.name }}-{{ template.suffix | handle }}{% endif %}">
  <a class="skip-link visually-hidden" href="#main-content">Skip to content</a>

  {%- comment -%} Announcement Bar {%- endcomment -%}
  {%- section 'announcement-bar' -%}

  {%- comment -%} Header / Navigation {%- endcomment -%}
  {%- section 'header' -%}

  <main id="main-content" role="main" tabindex="-1">
    {{ content_for_layout }}
  </main>

  {%- comment -%} Footer {%- endcomment -%}
  {%- section 'footer' -%}

  {%- comment -%} Email Popup {%- endcomment -%}
  {%- if settings.enable_email_popup -%}
    {%- render 'email-popup' -%}
  {%- endif -%}

  {%- comment -%} Cart Drawer {%- endcomment -%}
  {%- render 'cart-drawer' -%}

  {%- comment -%} Theme JavaScript {%- endcomment -%}
  {{ 'theme.js' | asset_url | script_tag }}

  {%- comment -%} E-commerce Tracking Events {%- endcomment -%}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Add to Cart tracking
      document.addEventListener('cart:item-added', function(event) {
        var product = event.detail;

        // GA4 add_to_cart event
        if (typeof gtag !== 'undefined') {
          gtag('event', 'add_to_cart', {
            currency: window.ShelzysConfig.shop.currency,
            value: product.price / 100,
            items: [{
              item_id: product.variant_id,
              item_name: product.title,
              price: product.price / 100,
              quantity: product.quantity
            }]
          });
        }

        // Facebook Pixel AddToCart
        if (typeof fbq !== 'undefined') {
          fbq('track', 'AddToCart', {
            content_ids: [product.variant_id],
            content_name: product.title,
            content_type: 'product',
            value: product.price / 100,
            currency: window.ShelzysConfig.shop.currency
          });
        }
      });

      // Begin checkout tracking
      document.addEventListener('cart:checkout-started', function(event) {
        var cart = event.detail;

        // GA4 begin_checkout event
        if (typeof gtag !== 'undefined') {
          gtag('event', 'begin_checkout', {
            currency: window.ShelzysConfig.shop.currency,
            value: cart.total_price / 100,
            items: cart.items.map(function(item) {
              return {
                item_id: item.variant_id,
                item_name: item.title,
                price: item.price / 100,
                quantity: item.quantity
              };
            })
          });
        }

        // Facebook Pixel InitiateCheckout
        if (typeof fbq !== 'undefined') {
          fbq('track', 'InitiateCheckout', {
            content_ids: cart.items.map(function(item) { return item.variant_id; }),
            num_items: cart.item_count,
            value: cart.total_price / 100,
            currency: window.ShelzysConfig.shop.currency
          });
        }
      });
    });
  </script>
</body>
</html>
