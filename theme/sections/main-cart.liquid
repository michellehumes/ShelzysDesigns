{%- comment -%}
  Main Cart Section
  Full cart page with free shipping bar and upsells
{%- endcomment -%}

<section class="cart-section section-padding">
  <div class="container">
    <h1 class="cart-title">Your Cart</h1>

    {%- if cart.item_count > 0 -%}
      {%- comment -%} Free Shipping Bar {%- endcomment -%}
      {%- if settings.enable_free_shipping_bar -%}
        {%- assign threshold = settings.free_shipping_threshold | default: 50 | times: 100 -%}
        {%- assign remaining = threshold | minus: cart.total_price -%}
        {%- assign progress = cart.total_price | times: 100.0 | divided_by: threshold -%}
        {%- if progress > 100 -%}{%- assign progress = 100 -%}{%- endif -%}

        <div class="cart-shipping-bar free-shipping-bar{% if remaining <= 0 %} free-shipping-bar--achieved{% endif %}">
          <p class="free-shipping-bar__message">
            {%- if remaining > 0 -%}
              Add {{ remaining | money }} more to unlock FREE SHIPPING!
            {%- else -%}
              You've unlocked FREE SHIPPING!
            {%- endif -%}
          </p>
          <div class="free-shipping-bar__progress">
            <div class="free-shipping-bar__progress-fill" style="width: {{ progress }}%;"></div>
          </div>
        </div>
      {%- endif -%}

      <form action="/cart" method="post" class="cart-form">
        <div class="cart-layout">
          <div class="cart-items">
            {%- for item in cart.items -%}
              <div class="cart-item" data-line="{{ forloop.index }}">
                <a href="{{ item.url }}" class="cart-item__image">
                  {%- if item.image -%}
                    <img src="{{ item.image | image_url: width: 150 }}" alt="{{ item.title | escape }}">
                  {%- else -%}
                    {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
                  {%- endif -%}
                </a>

                <div class="cart-item__details">
                  <h3 class="cart-item__title">
                    <a href="{{ item.url }}">{{ item.product.title }}</a>
                  </h3>

                  {%- if item.variant.title != 'Default Title' -%}
                    <p class="cart-item__variant">{{ item.variant.title }}</p>
                  {%- endif -%}

                  {%- if item.properties.size > 0 -%}
                    <div class="cart-item__properties">
                      {%- for property in item.properties -%}
                        {%- unless property.last == blank -%}
                          <p><span>{{ property.first }}:</span> {{ property.last }}</p>
                        {%- endunless -%}
                      {%- endfor -%}
                    </div>
                  {%- endif -%}

                  <p class="cart-item__unit-price">{{ item.price | money }} each</p>
                </div>

                <div class="cart-item__quantity">
                  <label class="visually-hidden" for="quantity-{{ forloop.index }}">Quantity</label>
                  <div class="quantity-selector">
                    <button type="button" class="quantity-btn" onclick="this.nextElementSibling.stepDown(); this.form.submit();">-</button>
                    <input
                      type="number"
                      name="updates[]"
                      id="quantity-{{ forloop.index }}"
                      value="{{ item.quantity }}"
                      min="0"
                      class="quantity-input"
                    >
                    <button type="button" class="quantity-btn" onclick="this.previousElementSibling.stepUp(); this.form.submit();">+</button>
                  </div>
                </div>

                <div class="cart-item__price">
                  {{ item.final_line_price | money }}
                </div>

                <a href="/cart/change?line={{ forloop.index }}&quantity=0" class="cart-item__remove" aria-label="Remove {{ item.title }}">
                  <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.5">
                    <line x1="3" y1="3" x2="15" y2="15"></line>
                    <line x1="15" y1="3" x2="3" y2="15"></line>
                  </svg>
                </a>
              </div>
            {%- endfor -%}
          </div>

          <div class="cart-summary">
            {%- comment -%} Upsell {%- endcomment -%}
            {%- if settings.enable_cart_upsell -%}
              <div class="cart-upsell">
                <p>{{ settings.upsell_message }}</p>
                <a href="/collections/bridal-party-sets" class="cart-upsell__link">Shop Bundle Sets</a>
              </div>
            {%- endif -%}

            <div class="cart-totals">
              <div class="cart-totals__row">
                <span>Subtotal</span>
                <span>{{ cart.total_price | money }}</span>
              </div>
              <p class="cart-totals__note">Shipping & taxes calculated at checkout</p>
            </div>

            <button type="submit" name="checkout" class="btn btn-primary btn-lg cart-checkout">
              Checkout
            </button>

            <button type="submit" name="update" class="btn btn-secondary cart-update">
              Update Cart
            </button>
          </div>
        </div>
      </form>

    {%- else -%}
      <div class="cart-empty">
        <p>Your cart is empty.</p>
        <p>Ready to create something special?</p>
        <a href="/collections/best-sellers" class="btn btn-primary">Shop Best Sellers</a>
      </div>
    {%- endif -%}
  </div>
</section>

<style>
.cart-title {
  text-align: center;
  margin-bottom: 2rem;
}

.cart-shipping-bar {
  max-width: 600px;
  margin: 0 auto 2rem;
}

.cart-layout {
  display: grid;
  grid-template-columns: 1fr 380px;
  gap: 40px;
  align-items: start;
}

.cart-items {
  border-top: 1px solid #F7F4EF;
}

.cart-item {
  display: grid;
  grid-template-columns: 100px 1fr auto 100px 40px;
  gap: 20px;
  align-items: center;
  padding: 1.5rem 0;
  border-bottom: 1px solid #F7F4EF;
}

.cart-item__image {
  border-radius: 8px;
  overflow: hidden;
  background: #F7F4EF;
}

.cart-item__image img {
  width: 100%;
  height: auto;
}

.cart-item__title {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 4px;
}

.cart-item__title a {
  color: #111111;
  text-decoration: none;
}

.cart-item__variant,
.cart-item__unit-price {
  font-size: 13px;
  color: #666666;
  margin: 0;
}

.cart-item__properties {
  margin-top: 8px;
}

.cart-item__properties p {
  font-size: 12px;
  color: #666666;
  margin: 0;
  line-height: 1.5;
}

.cart-item__properties span {
  font-weight: 500;
}

.cart-item__price {
  font-weight: 600;
  text-align: right;
}

.cart-item__remove {
  color: #888888;
  transition: color 0.2s ease;
}

.cart-item__remove:hover {
  color: #C74B4B;
}

.cart-summary {
  background: #F7F4EF;
  padding: 2rem;
  border-radius: 12px;
  position: sticky;
  top: 100px;
}

.cart-upsell {
  background: #FFFFFF;
  padding: 1rem;
  border-radius: 8px;
  margin-bottom: 1.5rem;
  font-size: 14px;
  text-align: center;
}

.cart-upsell p {
  margin: 0 0 8px;
  color: #666666;
}

.cart-upsell__link {
  color: #9CAE8C;
  font-weight: 600;
  text-decoration: none;
}

.cart-totals {
  margin-bottom: 1.5rem;
}

.cart-totals__row {
  display: flex;
  justify-content: space-between;
  font-size: 18px;
  font-weight: 600;
}

.cart-totals__note {
  font-size: 13px;
  color: #666666;
  margin-top: 8px;
}

.cart-checkout {
  width: 100%;
  margin-bottom: 1rem;
}

.cart-update {
  width: 100%;
}

.cart-empty {
  text-align: center;
  padding: 80px 20px;
}

.cart-empty p {
  color: #666666;
  margin-bottom: 8px;
}

.cart-empty .btn {
  margin-top: 1.5rem;
}

@media (max-width: 968px) {
  .cart-layout {
    grid-template-columns: 1fr;
  }

  .cart-item {
    grid-template-columns: 80px 1fr 40px;
    grid-template-rows: auto auto;
  }

  .cart-item__quantity {
    grid-column: 2;
    grid-row: 2;
  }

  .cart-item__price {
    grid-column: 2;
    grid-row: 2;
    text-align: right;
  }

  .cart-item__remove {
    grid-column: 3;
    grid-row: 1 / 3;
  }

  .cart-summary {
    position: static;
  }
}
</style>

{% schema %}
{
  "name": "Main Cart",
  "tag": "section",
  "class": "section-main-cart",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show vendor",
      "default": false
    }
  ]
}
{% endschema %}
