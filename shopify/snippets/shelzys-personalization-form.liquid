{% comment %}
  Enhanced Personalization Form with Live Preview
  20 Font Options & 20 Color Options
  Installation: Replace default variant selector on product pages
{% endcomment %}

<!-- Google Fonts for extended font options -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Alex+Brush&family=Allura&family=Amatic+SC:wght@700&family=Cinzel&family=Cormorant+Garamond:ital,wght@0,500;1,500&family=Dancing+Script:wght@600&family=Great+Vibes&family=Josefin+Sans:wght@300&family=Lato:wght@300;700&family=Libre+Baskerville:ital@0;1&family=Lobster&family=Montserrat:wght@300;600&family=Pacifico&family=Playfair+Display:ital@0;1&family=Poppins:wght@300;600&family=Quicksand:wght@500&family=Raleway:wght@300&family=Sacramento&family=Satisfy&display=swap" rel="stylesheet">

<style>
  .shelzy-personalization {
    margin: 20px 0;
  }

  .shelzy-personalization-group {
    margin-bottom: 20px;
  }

  .shelzy-personalization-label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: #321004;
    margin-bottom: 8px;
  }

  .shelzy-personalization-label small {
    font-weight: 400;
    color: #999;
  }

  .shelzy-personalization-input {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid #e5e5e5;
    border-radius: 8px;
    font-size: 16px;
    transition: border-color 0.2s;
    box-sizing: border-box;
  }

  .shelzy-personalization-input:focus {
    outline: none;
    border-color: #321004;
  }

  .shelzy-personalization-input.error {
    border-color: #dc2626;
  }

  .shelzy-char-count {
    font-size: 12px;
    color: #999;
    text-align: right;
    margin-top: 4px;
  }

  .shelzy-char-count.warning {
    color: #f59e0b;
  }

  .shelzy-char-count.error {
    color: #dc2626;
  }

  .shelzy-font-selector {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    max-height: 320px;
    overflow-y: auto;
    padding: 4px;
  }

  @media (max-width: 768px) {
    .shelzy-font-selector {
      grid-template-columns: repeat(2, 1fr);
      max-height: 400px;
    }
  }

  .shelzy-font-option {
    padding: 10px 8px;
    border: 2px solid #e5e5e5;
    border-radius: 8px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    min-height: 60px;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .shelzy-font-option:hover {
    border-color: #ccc;
  }

  .shelzy-font-option.selected {
    border-color: #321004;
    background: #faf9f7;
  }

  .shelzy-font-option input {
    display: none;
  }

  .shelzy-font-preview {
    font-size: 16px;
    display: block;
    margin-bottom: 2px;
    line-height: 1.2;
  }

  .shelzy-font-name {
    font-size: 9px;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* 20 Font Classes */
  .font-script { font-family: 'Great Vibes', cursive; }
  .font-classic { font-family: 'Playfair Display', serif; }
  .font-modern { font-family: 'Montserrat', sans-serif; font-weight: 300; }
  .font-elegant { font-family: 'Cormorant Garamond', serif; font-weight: 500; }
  .font-romantic { font-family: 'Allura', cursive; }
  .font-playful { font-family: 'Pacifico', cursive; }
  .font-coastal { font-family: 'Quicksand', sans-serif; font-weight: 500; }
  .font-vintage { font-family: 'Cinzel', serif; }
  .font-handwritten { font-family: 'Dancing Script', cursive; font-weight: 600; }
  .font-minimal { font-family: 'Josefin Sans', sans-serif; font-weight: 300; }
  .font-bold { font-family: 'Montserrat', sans-serif; font-weight: 600; }
  .font-thin { font-family: 'Raleway', sans-serif; font-weight: 300; }
  .font-cursive { font-family: 'Sacramento', cursive; }
  .font-brush { font-family: 'Alex Brush', cursive; }
  .font-sweet { font-family: 'Satisfy', cursive; }
  .font-artsy { font-family: 'Amatic SC', cursive; font-weight: 700; }
  .font-literary { font-family: 'Libre Baskerville', serif; }
  .font-italic { font-family: 'Libre Baskerville', serif; font-style: italic; }
  .font-retro { font-family: 'Lobster', cursive; }
  .font-clean { font-family: 'Poppins', sans-serif; font-weight: 300; }

  .shelzy-color-selector {
    display: grid;
    grid-template-columns: repeat(10, 1fr);
    gap: 8px;
    flex-wrap: wrap;
  }

  @media (max-width: 768px) {
    .shelzy-color-selector {
      grid-template-columns: repeat(5, 1fr);
    }
  }

  .shelzy-color-option {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    cursor: pointer;
    border: 3px solid transparent;
    transition: all 0.2s;
    position: relative;
  }

  .shelzy-color-option:hover {
    transform: scale(1.15);
  }

  .shelzy-color-option.selected {
    border-color: #321004;
  }

  .shelzy-color-option.selected::after {
    content: 'âœ“';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #fff;
    font-size: 12px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  }

  .shelzy-color-option.light-color.selected::after {
    color: #333;
    text-shadow: none;
  }

  .shelzy-color-option input {
    display: none;
  }

  /* Live Preview */
  .shelzy-preview {
    background: linear-gradient(135deg, #f5f5f5 0%, #e5e5e5 100%);
    border-radius: 12px;
    padding: 30px;
    margin: 20px 0;
    text-align: center;
  }

  .shelzy-preview-bottle {
    width: 120px;
    height: 200px;
    background: linear-gradient(180deg, #FFFFFF 0%, #F5F5F5 100%);
    border-radius: 12px 12px 40px 40px;
    margin: 0 auto 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    border: 1px solid #e0e0e0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }

  .shelzy-preview-bottle::before {
    content: '';
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    width: 40px;
    height: 20px;
    background: #E8E8E8;
    border-radius: 4px 4px 0 0;
    border: 1px solid #d0d0d0;
    border-bottom: none;
  }

  .shelzy-preview-text {
    font-size: 16px;
    max-width: 80px;
    word-wrap: break-word;
    line-height: 1.2;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  }

  .shelzy-preview-label {
    font-size: 12px;
    color: #666;
  }

  /* Multiple names for sets */
  .shelzy-names-list {
    margin-top: 10px;
  }

  .shelzy-names-list textarea {
    width: 100%;
    min-height: 100px;
    padding: 14px 16px;
    border: 2px solid #e5e5e5;
    border-radius: 8px;
    font-size: 14px;
    font-family: inherit;
    resize: vertical;
    box-sizing: border-box;
  }

  .shelzy-names-list textarea:focus {
    outline: none;
    border-color: #321004;
  }

  .shelzy-names-hint {
    font-size: 12px;
    color: #666;
    margin-top: 8px;
  }

  .shelzy-names-count {
    font-size: 13px;
    color: #321004;
    font-weight: 600;
    margin-top: 8px;
  }

  .shelzy-proof-request {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 16px;
    background: #f5f5f5;
    border-radius: 8px;
    margin-top: 20px;
  }

  .shelzy-proof-request input {
    width: 18px;
    height: 18px;
  }

  .shelzy-proof-request label {
    font-size: 14px;
    color: #333;
    cursor: pointer;
  }

  .shelzy-proof-request small {
    display: block;
    color: #666;
    font-size: 12px;
    margin-top: 2px;
  }
</style>

<div class="shelzy-personalization" id="personalizationForm">
  {% comment %} Single name or multiple based on product type {% endcomment %}
  {% if product.tags contains 'set' or product.title contains 'Set' %}
    <!-- Multiple Names Input -->
    <div class="shelzy-personalization-group">
      <label class="shelzy-personalization-label">
        Names to Personalize <small>(one per line)</small>
      </label>
      <div class="shelzy-names-list">
        <textarea
          name="properties[Names]"
          id="namesInput"
          placeholder="Sarah&#10;Emily&#10;Jessica&#10;Amanda&#10;Nicole&#10;Ashley"
          required
        ></textarea>
        <p class="shelzy-names-hint">Enter each name on a new line. We'll match the number of names to your quantity.</p>
        <p class="shelzy-names-count" id="namesCount">0 names entered</p>
      </div>
    </div>
  {% else %}
    <!-- Single Name Input -->
    <div class="shelzy-personalization-group">
      <label class="shelzy-personalization-label">
        Name to Print <small>(max 15 characters recommended)</small>
      </label>
      <input
        type="text"
        name="properties[Name]"
        id="nameInput"
        class="shelzy-personalization-input"
        maxlength="20"
        placeholder="Enter name here..."
        required
      >
      <p class="shelzy-char-count"><span id="charCount">0</span>/15 characters</p>
    </div>
  {% endif %}

  <!-- Font Selection - 20 Options -->
  <div class="shelzy-personalization-group">
    <label class="shelzy-personalization-label">Font Style <small>(20 options)</small></label>
    <div class="shelzy-font-selector">
      <label class="shelzy-font-option selected" data-font="script">
        <input type="radio" name="properties[Font]" value="Script" checked>
        <span class="shelzy-font-preview font-script">Abc</span>
        <span class="shelzy-font-name">Script</span>
      </label>
      <label class="shelzy-font-option" data-font="classic">
        <input type="radio" name="properties[Font]" value="Classic">
        <span class="shelzy-font-preview font-classic">Abc</span>
        <span class="shelzy-font-name">Classic</span>
      </label>
      <label class="shelzy-font-option" data-font="modern">
        <input type="radio" name="properties[Font]" value="Modern">
        <span class="shelzy-font-preview font-modern">Abc</span>
        <span class="shelzy-font-name">Modern</span>
      </label>
      <label class="shelzy-font-option" data-font="elegant">
        <input type="radio" name="properties[Font]" value="Elegant">
        <span class="shelzy-font-preview font-elegant">Abc</span>
        <span class="shelzy-font-name">Elegant</span>
      </label>
      <label class="shelzy-font-option" data-font="romantic">
        <input type="radio" name="properties[Font]" value="Romantic">
        <span class="shelzy-font-preview font-romantic">Abc</span>
        <span class="shelzy-font-name">Romantic</span>
      </label>
      <label class="shelzy-font-option" data-font="playful">
        <input type="radio" name="properties[Font]" value="Playful">
        <span class="shelzy-font-preview font-playful">Abc</span>
        <span class="shelzy-font-name">Playful</span>
      </label>
      <label class="shelzy-font-option" data-font="coastal">
        <input type="radio" name="properties[Font]" value="Coastal">
        <span class="shelzy-font-preview font-coastal">Abc</span>
        <span class="shelzy-font-name">Coastal</span>
      </label>
      <label class="shelzy-font-option" data-font="vintage">
        <input type="radio" name="properties[Font]" value="Vintage">
        <span class="shelzy-font-preview font-vintage">Abc</span>
        <span class="shelzy-font-name">Vintage</span>
      </label>
      <label class="shelzy-font-option" data-font="handwritten">
        <input type="radio" name="properties[Font]" value="Handwritten">
        <span class="shelzy-font-preview font-handwritten">Abc</span>
        <span class="shelzy-font-name">Handwritten</span>
      </label>
      <label class="shelzy-font-option" data-font="minimal">
        <input type="radio" name="properties[Font]" value="Minimal">
        <span class="shelzy-font-preview font-minimal">Abc</span>
        <span class="shelzy-font-name">Minimal</span>
      </label>
      <label class="shelzy-font-option" data-font="bold">
        <input type="radio" name="properties[Font]" value="Bold">
        <span class="shelzy-font-preview font-bold">Abc</span>
        <span class="shelzy-font-name">Bold</span>
      </label>
      <label class="shelzy-font-option" data-font="thin">
        <input type="radio" name="properties[Font]" value="Thin">
        <span class="shelzy-font-preview font-thin">Abc</span>
        <span class="shelzy-font-name">Thin</span>
      </label>
      <label class="shelzy-font-option" data-font="cursive">
        <input type="radio" name="properties[Font]" value="Cursive">
        <span class="shelzy-font-preview font-cursive">Abc</span>
        <span class="shelzy-font-name">Cursive</span>
      </label>
      <label class="shelzy-font-option" data-font="brush">
        <input type="radio" name="properties[Font]" value="Brush">
        <span class="shelzy-font-preview font-brush">Abc</span>
        <span class="shelzy-font-name">Brush</span>
      </label>
      <label class="shelzy-font-option" data-font="sweet">
        <input type="radio" name="properties[Font]" value="Sweet">
        <span class="shelzy-font-preview font-sweet">Abc</span>
        <span class="shelzy-font-name">Sweet</span>
      </label>
      <label class="shelzy-font-option" data-font="artsy">
        <input type="radio" name="properties[Font]" value="Artsy">
        <span class="shelzy-font-preview font-artsy">Abc</span>
        <span class="shelzy-font-name">Artsy</span>
      </label>
      <label class="shelzy-font-option" data-font="literary">
        <input type="radio" name="properties[Font]" value="Literary">
        <span class="shelzy-font-preview font-literary">Abc</span>
        <span class="shelzy-font-name">Literary</span>
      </label>
      <label class="shelzy-font-option" data-font="italic">
        <input type="radio" name="properties[Font]" value="Italic">
        <span class="shelzy-font-preview font-italic">Abc</span>
        <span class="shelzy-font-name">Italic</span>
      </label>
      <label class="shelzy-font-option" data-font="retro">
        <input type="radio" name="properties[Font]" value="Retro">
        <span class="shelzy-font-preview font-retro">Abc</span>
        <span class="shelzy-font-name">Retro</span>
      </label>
      <label class="shelzy-font-option" data-font="clean">
        <input type="radio" name="properties[Font]" value="Clean">
        <span class="shelzy-font-preview font-clean">Abc</span>
        <span class="shelzy-font-name">Clean</span>
      </label>
    </div>
  </div>

  <!-- Color Selection - 20 Options -->
  <div class="shelzy-personalization-group">
    <label class="shelzy-personalization-label">Text Color <small>(20 options)</small></label>
    <div class="shelzy-color-selector">
      <!-- Row 1: Basics -->
      <label class="shelzy-color-option selected" style="background: #000000;" data-color="#000000" title="Black">
        <input type="radio" name="properties[Text Color]" value="Black" checked>
      </label>
      <label class="shelzy-color-option" style="background: #808080;" data-color="#808080" title="Gray">
        <input type="radio" name="properties[Text Color]" value="Gray">
      </label>
      <label class="shelzy-color-option light-color" style="background: #ffffff; border: 1px solid #ddd;" data-color="#ffffff" title="White">
        <input type="radio" name="properties[Text Color]" value="White">
      </label>
      <label class="shelzy-color-option" style="background: #8B4513;" data-color="#8B4513" title="Brown">
        <input type="radio" name="properties[Text Color]" value="Brown">
      </label>
      <label class="shelzy-color-option" style="background: #D2B48C;" data-color="#D2B48C" title="Tan">
        <input type="radio" name="properties[Text Color]" value="Tan">
      </label>
      <!-- Row 2: Warm Colors -->
      <label class="shelzy-color-option light-color" style="background: #FFD700;" data-color="#FFD700" title="Yellow">
        <input type="radio" name="properties[Text Color]" value="Yellow">
      </label>
      <label class="shelzy-color-option" style="background: #FFA500;" data-color="#FFA500" title="Orange">
        <input type="radio" name="properties[Text Color]" value="Orange">
      </label>
      <label class="shelzy-color-option" style="background: #FF7F50;" data-color="#FF7F50" title="Coral">
        <input type="radio" name="properties[Text Color]" value="Coral">
      </label>
      <label class="shelzy-color-option" style="background: #FF0000;" data-color="#FF0000" title="Red">
        <input type="radio" name="properties[Text Color]" value="Red">
      </label>
      <label class="shelzy-color-option" style="background: #FF69B4;" data-color="#FF69B4" title="Pink">
        <input type="radio" name="properties[Text Color]" value="Pink">
      </label>
      <!-- Row 3: Cool Colors -->
      <label class="shelzy-color-option" style="background: #800080;" data-color="#800080" title="Purple">
        <input type="radio" name="properties[Text Color]" value="Purple">
      </label>
      <label class="shelzy-color-option" style="background: #EE82EE;" data-color="#EE82EE" title="Violet">
        <input type="radio" name="properties[Text Color]" value="Violet">
      </label>
      <label class="shelzy-color-option" style="background: #0000FF;" data-color="#0000FF" title="Blue">
        <input type="radio" name="properties[Text Color]" value="Blue">
      </label>
      <label class="shelzy-color-option" style="background: #87CEEB;" data-color="#87CEEB" title="Light Blue">
        <input type="radio" name="properties[Text Color]" value="Light Blue">
      </label>
      <label class="shelzy-color-option" style="background: #000080;" data-color="#000080" title="Navy">
        <input type="radio" name="properties[Text Color]" value="Navy">
      </label>
      <!-- Row 4: Greens & Metallics -->
      <label class="shelzy-color-option" style="background: #008000;" data-color="#008000" title="Green">
        <input type="radio" name="properties[Text Color]" value="Green">
      </label>
      <label class="shelzy-color-option" style="background: #90EE90;" data-color="#90EE90" title="Light Green">
        <input type="radio" name="properties[Text Color]" value="Light Green">
      </label>
      <label class="shelzy-color-option" style="background: #008080;" data-color="#008080" title="Teal">
        <input type="radio" name="properties[Text Color]" value="Teal">
      </label>
      <label class="shelzy-color-option" style="background: #D4AF37;" data-color="#D4AF37" title="Gold">
        <input type="radio" name="properties[Text Color]" value="Gold">
      </label>
      <label class="shelzy-color-option" style="background: #C0C0C0;" data-color="#C0C0C0" title="Silver">
        <input type="radio" name="properties[Text Color]" value="Silver">
      </label>
    </div>
  </div>

  <!-- Live Preview -->
  <div class="shelzy-preview">
    <p class="shelzy-preview-label">Preview</p>
    <div class="shelzy-preview-bottle">
      <span class="shelzy-preview-text font-script" id="previewText" style="color: #000000;">
        Your Name
      </span>
    </div>
  </div>

  <!-- Proof Request -->
  <div class="shelzy-proof-request">
    <input type="checkbox" name="properties[Request Proof]" id="proofRequest" value="Yes">
    <label for="proofRequest">
      Send me a design proof before production
      <small>We'll email a mockup for approval (adds 1 business day)</small>
    </label>
  </div>
</div>

<script>
(function() {
  const nameInput = document.getElementById('nameInput');
  const namesInput = document.getElementById('namesInput');
  const charCount = document.getElementById('charCount');
  const namesCount = document.getElementById('namesCount');
  const previewText = document.getElementById('previewText');
  const fontOptions = document.querySelectorAll('.shelzy-font-option');
  const colorOptions = document.querySelectorAll('.shelzy-color-option');

  // Single name input handler
  if (nameInput) {
    nameInput.addEventListener('input', function() {
      const length = this.value.length;
      charCount.textContent = length;

      // Update character count styling
      const countEl = charCount.parentElement;
      countEl.classList.remove('warning', 'error');
      if (length > 15) countEl.classList.add('warning');
      if (length > 18) countEl.classList.add('error');

      // Update preview
      previewText.textContent = this.value || 'Your Name';
    });
  }

  // Multiple names input handler
  if (namesInput) {
    namesInput.addEventListener('input', function() {
      const names = this.value.split('\n').filter(n => n.trim() !== '');
      namesCount.textContent = names.length + ' name' + (names.length !== 1 ? 's' : '') + ' entered';

      // Show first name in preview
      previewText.textContent = names[0] || 'Your Name';
    });
  }

  // Font selection
  fontOptions.forEach(option => {
    option.addEventListener('click', function() {
      fontOptions.forEach(o => o.classList.remove('selected'));
      this.classList.add('selected');
      this.querySelector('input').checked = true;

      // Update preview font
      const font = this.dataset.font;
      previewText.className = 'shelzy-preview-text font-' + font;
    });
  });

  // Color selection
  colorOptions.forEach(option => {
    option.addEventListener('click', function() {
      colorOptions.forEach(o => o.classList.remove('selected'));
      this.classList.add('selected');
      this.querySelector('input').checked = true;

      // Update preview color
      previewText.style.color = this.dataset.color;
    });
  });
})();
</script>
