{%- comment -%}
  Shelzy's Designs - Smart Cart Upsell

  Shows contextual upsell suggestions based on cart contents
  Recommends gift boxes for single bottles, bundles for multiple items

  Add to cart drawer/page after cart items:
  {% render 'shelzys-cart-upsell' %}
{%- endcomment -%}

{% assign has_single_bottle = false %}
{% assign has_bridal_item = false %}
{% assign cart_item_count = cart.item_count %}

{%- comment -%} Analyze cart contents {%- endcomment -%}
{% for item in cart.items %}
  {% assign product_tags = item.product.tags | join: ',' | downcase %}
  {% assign product_type = item.product.type | downcase %}

  {% if product_type contains 'bottle' or product_tags contains 'bottle' %}
    {% if item.quantity == 1 and cart_item_count < 3 %}
      {% assign has_single_bottle = true %}
    {% endif %}
  {% endif %}

  {% if product_tags contains 'bridal' or product_tags contains 'bridesmaid' or product_tags contains 'wedding' %}
    {% assign has_bridal_item = true %}
  {% endif %}
{% endfor %}

<style>
  .sz-upsell-wrapper {
    padding: 16px;
    background: linear-gradient(135deg, #FAF9F6 0%, #ffffff 100%);
    border: 1px solid #E0E3DF;
    border-radius: 12px;
    margin: 16px 0;
  }

  .sz-upsell-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
  }

  .sz-upsell-icon {
    font-size: 18px;
  }

  .sz-upsell-title {
    font-family: "Inter", sans-serif;
    font-size: 13px;
    font-weight: 600;
    color: #4E5F4A;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  .sz-upsell-content {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .sz-upsell-image {
    width: 70px;
    height: 70px;
    object-fit: cover;
    border-radius: 8px;
    border: 1px solid #E0E3DF;
    flex-shrink: 0;
  }

  .sz-upsell-info {
    flex: 1;
    min-width: 0;
  }

  .sz-upsell-product-name {
    font-family: "Inter", sans-serif;
    font-size: 14px;
    font-weight: 500;
    color: #2B2B2B;
    margin: 0 0 4px 0;
    line-height: 1.3;
  }

  .sz-upsell-savings {
    font-family: "Montserrat", sans-serif;
    font-size: 11px;
    font-weight: 600;
    color: #8BAA88;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .sz-upsell-price {
    font-family: "Inter", sans-serif;
    font-size: 14px;
    color: #2B2B2B;
    margin-top: 4px;
  }

  .sz-upsell-price .sz-compare-price {
    text-decoration: line-through;
    color: #999;
    margin-right: 6px;
    font-size: 12px;
  }

  .sz-upsell-button {
    display: inline-block;
    padding: 10px 16px;
    background: #8BAA88;
    color: #ffffff;
    border: none;
    border-radius: 999px;
    font-family: "Inter", sans-serif;
    font-size: 12px;
    font-weight: 600;
    letter-spacing: 0.04em;
    cursor: pointer;
    transition: background 0.2s ease;
    white-space: nowrap;
    text-decoration: none;
    flex-shrink: 0;
  }

  .sz-upsell-button:hover {
    background: #4E5F4A;
    color: #ffffff;
  }

  .sz-upsell-dismiss {
    position: absolute;
    top: 8px;
    right: 8px;
    background: none;
    border: none;
    color: #999;
    cursor: pointer;
    font-size: 16px;
    padding: 4px;
  }

  .sz-upsell-wrapper {
    position: relative;
  }

  @media (max-width: 480px) {
    .sz-upsell-content {
      flex-wrap: wrap;
    }

    .sz-upsell-button {
      width: 100%;
      text-align: center;
      margin-top: 8px;
    }
  }
</style>

{% if cart.item_count > 0 %}
<div class="sz-upsell-wrapper" id="szCartUpsell">
  <button class="sz-upsell-dismiss" onclick="this.parentElement.style.display='none'" aria-label="Dismiss">&times;</button>

  <div class="sz-upsell-header">
    <span class="sz-upsell-icon">ðŸ’¡</span>
    <span class="sz-upsell-title">Complete Your Order</span>
  </div>

  {% if has_bridal_item and has_single_bottle %}
    {%- comment -%} Suggest upgrading to gift box for bridal items {%- endcomment -%}
    <div class="sz-upsell-content">
      <img
        src="{{ 'gift-box-upsell.jpg' | file_url }}"
        alt="Gift Box Upgrade"
        class="sz-upsell-image"
        onerror="this.style.display='none'"
      >
      <div class="sz-upsell-info">
        <p class="sz-upsell-product-name">Upgrade to a Proposal Gift Box</p>
        <p class="sz-upsell-savings">Save 15% on the upgrade!</p>
        <p class="sz-upsell-price">
          Includes bottle, gift box, scrunchie & candle
        </p>
      </div>
      <a href="/collections/proposal-gift-boxes" class="sz-upsell-button">
        View Gift Boxes
      </a>
    </div>

  {% elsif has_single_bottle %}
    {%- comment -%} Suggest multi-pack for single bottle purchases {%- endcomment -%}
    <div class="sz-upsell-content">
      <img
        src="{{ 'bundle-upsell.jpg' | file_url }}"
        alt="Bundle Deal"
        class="sz-upsell-image"
        onerror="this.style.display='none'"
      >
      <div class="sz-upsell-info">
        <p class="sz-upsell-product-name">Ordering for a group?</p>
        <p class="sz-upsell-savings">Save up to 20% with bundles</p>
        <p class="sz-upsell-price">
          3-packs, 5-packs, and 10-packs available
        </p>
      </div>
      <a href="/collections/best-sellers" class="sz-upsell-button">
        View Bundles
      </a>
    </div>

  {% elsif cart_item_count >= 3 %}
    {%- comment -%} For larger orders, highlight bulk savings {%- endcomment -%}
    <div class="sz-upsell-content">
      <div class="sz-upsell-info" style="flex: 1;">
        <p class="sz-upsell-product-name">Need more bottles?</p>
        <p class="sz-upsell-savings">Bulk orders get up to 20% off</p>
        <p class="sz-upsell-price">
          Perfect for large bridal parties, corporate events & teams
        </p>
      </div>
      <a href="/pages/bulk-orders" class="sz-upsell-button">
        Request Quote
      </a>
    </div>

  {% else %}
    {%- comment -%} Default upsell - best sellers {%- endcomment -%}
    <div class="sz-upsell-content">
      <div class="sz-upsell-info" style="flex: 1;">
        <p class="sz-upsell-product-name">Add another personalized bottle?</p>
        <p class="sz-upsell-savings">Perfect for gifting</p>
        <p class="sz-upsell-price">
          Free shipping on orders $75+
        </p>
      </div>
      <a href="/collections/best-sellers" class="sz-upsell-button">
        Shop Best Sellers
      </a>
    </div>
  {% endif %}
</div>
{% endif %}
