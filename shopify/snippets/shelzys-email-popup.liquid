{%- comment -%}
  Shelzy's Designs - Email Capture Popup

  Exit-intent popup offering 10% off first order
  Shows once per session using localStorage

  Add to theme.liquid before </body>:
  {% render 'shelzys-email-popup' %}
{%- endcomment -%}

<style>
  /* Email Popup Styles */
  .sz-popup-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    z-index: 9999;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .sz-popup-overlay.active {
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 1;
  }

  .sz-popup {
    background: #ffffff;
    border-radius: 16px;
    max-width: 480px;
    width: 90%;
    padding: 40px;
    position: relative;
    transform: translateY(20px);
    transition: transform 0.3s ease;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
  }

  .sz-popup-overlay.active .sz-popup {
    transform: translateY(0);
  }

  .sz-popup-close {
    position: absolute;
    top: 15px;
    right: 15px;
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #888;
    padding: 5px;
    line-height: 1;
  }

  .sz-popup-close:hover {
    color: #4E5F4A;
  }

  .sz-popup-badge {
    display: inline-block;
    background: #D1C7A1;
    color: #ffffff;
    font-family: "Montserrat", sans-serif;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    padding: 6px 14px;
    border-radius: 999px;
    margin-bottom: 16px;
  }

  .sz-popup h2 {
    font-family: "Playfair Display", serif;
    font-size: 32px;
    font-weight: 600;
    color: #4E5F4A;
    margin: 0 0 12px 0;
    line-height: 1.2;
  }

  .sz-popup p {
    font-family: "Inter", sans-serif;
    font-size: 16px;
    color: #2B2B2B;
    margin: 0 0 24px 0;
    line-height: 1.6;
  }

  .sz-popup-form {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .sz-popup-input {
    width: 100%;
    padding: 14px 18px;
    border: 1px solid #E0E3DF;
    border-radius: 999px;
    font-family: "Inter", sans-serif;
    font-size: 15px;
    outline: none;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
    box-sizing: border-box;
  }

  .sz-popup-input:focus {
    border-color: #8BAA88;
    box-shadow: 0 0 0 3px rgba(139, 170, 136, 0.15);
  }

  .sz-popup-input::placeholder {
    color: #999;
  }

  .sz-popup-button {
    width: 100%;
    padding: 14px 24px;
    background: #8BAA88;
    color: #ffffff;
    border: none;
    border-radius: 999px;
    font-family: "Inter", sans-serif;
    font-size: 15px;
    font-weight: 600;
    letter-spacing: 0.04em;
    cursor: pointer;
    transition: background 0.2s ease, transform 0.1s ease;
  }

  .sz-popup-button:hover {
    background: #4E5F4A;
  }

  .sz-popup-button:active {
    transform: scale(0.98);
  }

  .sz-popup-disclaimer {
    font-size: 12px;
    color: #888;
    text-align: center;
    margin-top: 12px;
  }

  .sz-popup-success {
    text-align: center;
    padding: 20px 0;
  }

  .sz-popup-success h3 {
    font-family: "Playfair Display", serif;
    font-size: 24px;
    color: #4E5F4A;
    margin: 0 0 8px 0;
  }

  .sz-popup-success p {
    margin-bottom: 16px;
  }

  .sz-popup-code {
    display: inline-block;
    background: #FAF9F6;
    border: 2px dashed #8BAA88;
    padding: 12px 24px;
    font-family: "Montserrat", sans-serif;
    font-size: 18px;
    font-weight: 700;
    letter-spacing: 0.1em;
    color: #4E5F4A;
    border-radius: 8px;
  }

  @media (max-width: 480px) {
    .sz-popup {
      padding: 30px 24px;
      margin: 16px;
    }

    .sz-popup h2 {
      font-size: 26px;
    }
  }
</style>

<div class="sz-popup-overlay" id="szEmailPopup">
  <div class="sz-popup">
    <button class="sz-popup-close" onclick="szClosePopup()" aria-label="Close popup">&times;</button>

    <div id="szPopupContent">
      <span class="sz-popup-badge">Exclusive Offer</span>
      <h2>Get 10% Off Your First Order</h2>
      <p>Join our email list for exclusive offers, new designs, and hydration inspiration.</p>

      <form class="sz-popup-form" id="szEmailForm" onsubmit="szHandleSubmit(event)">
        <input
          type="email"
          class="sz-popup-input"
          placeholder="Enter your email"
          required
          id="szEmailInput"
        >
        <button type="submit" class="sz-popup-button">Get My 10% Off</button>
      </form>

      <p class="sz-popup-disclaimer">No spam, ever. Unsubscribe anytime.</p>
    </div>

    <div id="szPopupSuccess" style="display: none;">
      <div class="sz-popup-success">
        <h3>Welcome to Shelzy's!</h3>
        <p>Use this code at checkout:</p>
        <div class="sz-popup-code">WELCOME10</div>
        <p style="margin-top: 16px; font-size: 14px;">Check your inbox for a welcome email with more details.</p>
      </div>
    </div>
  </div>
</div>

<script>
(function() {
  var POPUP_DELAY = 5000; // Show after 5 seconds if no exit intent
  var POPUP_SHOWN_KEY = 'sz_popup_shown';
  var popupShown = false;

  // Check if popup was already shown this session
  function wasPopupShown() {
    return sessionStorage.getItem(POPUP_SHOWN_KEY) === 'true';
  }

  // Mark popup as shown
  function markPopupShown() {
    sessionStorage.setItem(POPUP_SHOWN_KEY, 'true');
    popupShown = true;
  }

  // Show popup
  window.szShowPopup = function() {
    if (popupShown || wasPopupShown()) return;
    document.getElementById('szEmailPopup').classList.add('active');
    document.body.style.overflow = 'hidden';
    markPopupShown();
  };

  // Close popup
  window.szClosePopup = function() {
    document.getElementById('szEmailPopup').classList.remove('active');
    document.body.style.overflow = '';
  };

  // Handle form submit
  window.szHandleSubmit = function(e) {
    e.preventDefault();
    var email = document.getElementById('szEmailInput').value;

    // Send to Shopify customer API or your email service
    fetch('/contact#contact_form', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: 'form_type=customer&utf8=âœ“&contact[email]=' + encodeURIComponent(email) + '&contact[tags]=newsletter,popup'
    }).catch(function() {
      // Silently fail - still show success
    });

    // Show success state
    document.getElementById('szPopupContent').style.display = 'none';
    document.getElementById('szPopupSuccess').style.display = 'block';

    // Close after 5 seconds
    setTimeout(szClosePopup, 5000);
  };

  // Exit intent detection (desktop only)
  document.addEventListener('mouseout', function(e) {
    if (e.clientY < 10 && !popupShown && !wasPopupShown()) {
      szShowPopup();
    }
  });

  // Fallback: show after delay if user hasn't triggered exit intent
  setTimeout(function() {
    if (!popupShown && !wasPopupShown()) {
      szShowPopup();
    }
  }, POPUP_DELAY);

  // Close on overlay click
  document.getElementById('szEmailPopup').addEventListener('click', function(e) {
    if (e.target === this) {
      szClosePopup();
    }
  });

  // Close on escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      szClosePopup();
    }
  });
})();
</script>
