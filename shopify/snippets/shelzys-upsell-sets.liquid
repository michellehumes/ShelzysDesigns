{%- comment -%}
  Shelzy's Designs - Upsell to Sets

  Shows on single bottle pages to promote sets
  Add to product template: {% render 'shelzys-upsell-sets' %}
{%- endcomment -%}

{%- liquid
  # Check if this is a single bottle (not already a set)
  assign is_single = true

  if product.title contains 'Set of' or product.tags contains 'set' or product.tags contains 'bundle'
    assign is_single = false
  endif

  # Find best-selling set products
  assign sets_collection = collections['sets'] | default: collections['bundles'] | default: collections['best-sellers']
-%}

{%- if is_single -%}
  <div class="sz-upsell-sets">
    <div class="sz-upsell-header">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
      </svg>
      <h4>Upgrade to a Set & Save</h4>
    </div>

    <p class="sz-upsell-text">
      Planning a wedding or event? Our sets offer the best value with savings up to 30%.
    </p>

    <div class="sz-upsell-products">
      {%- if sets_collection -%}
        {%- assign shown_count = 0 -%}
        {%- for set_product in sets_collection.products -%}
          {%- if set_product.title contains 'Set' and set_product.available and shown_count < 2 -%}
            <a href="{{ set_product.url }}" class="sz-upsell-product">
              {%- if set_product.featured_image -%}
                <img
                  src="{{ set_product.featured_image | img_url: '150x150', crop: 'center' }}"
                  alt="{{ set_product.title | escape }}"
                  loading="lazy"
                >
              {%- endif -%}
              <div class="sz-upsell-product-info">
                <span class="sz-upsell-product-title">{{ set_product.title | truncate: 30 }}</span>
                <span class="sz-upsell-product-price">{{ set_product.price | money }}</span>
              </div>
            </a>
            {%- assign shown_count = shown_count | plus: 1 -%}
          {%- endif -%}
        {%- endfor -%}
      {%- endif -%}
    </div>

    <a href="{{ sets_collection.url | default: '/collections/all?filter.p.tag=set' }}" class="sz-upsell-link">
      View All Sets â†’
    </a>
  </div>
{%- endif -%}

<style>
  .sz-upsell-sets {
    margin: 24px 0;
    padding: 24px;
    background: #FAF8F5;
    border: 1px solid #E8E4DE;
  }

  .sz-upsell-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
  }

  .sz-upsell-header svg {
    color: #B76E79;
  }

  .sz-upsell-header h4 {
    font-family: "Inter", sans-serif;
    font-size: 16px;
    font-weight: 600;
    color: #1F1F1F;
    margin: 0;
  }

  .sz-upsell-text {
    font-family: "Inter", sans-serif;
    font-size: 14px;
    line-height: 1.5;
    color: #7A7A7A;
    margin: 0 0 20px 0;
  }

  .sz-upsell-products {
    display: flex;
    gap: 12px;
    margin-bottom: 16px;
  }

  @media (max-width: 400px) {
    .sz-upsell-products {
      flex-direction: column;
    }
  }

  .sz-upsell-product {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: #FFFFFF;
    border: 1px solid #E8E4DE;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .sz-upsell-product:hover {
    border-color: #2C3E2D;
  }

  .sz-upsell-product img {
    width: 60px;
    height: 60px;
    object-fit: cover;
    flex-shrink: 0;
  }

  .sz-upsell-product-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
    min-width: 0;
  }

  .sz-upsell-product-title {
    font-family: "Inter", sans-serif;
    font-size: 13px;
    font-weight: 500;
    color: #1F1F1F;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .sz-upsell-product-price {
    font-family: "Inter", sans-serif;
    font-size: 14px;
    font-weight: 600;
    color: #2C3E2D;
  }

  .sz-upsell-link {
    display: inline-block;
    font-family: "Inter", sans-serif;
    font-size: 14px;
    font-weight: 500;
    color: #2C3E2D;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .sz-upsell-link:hover {
    color: #1F1F1F;
    text-decoration: underline;
  }
</style>
