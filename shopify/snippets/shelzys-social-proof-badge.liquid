{%- comment -%}
  Shelzy's Designs - Social Proof Badge

  Displays social proof indicators on product pages:
  - Recently ordered count
  - Customer viewing count
  - Bestseller status

  Add to product pages:
  {% render 'shelzys-social-proof-badge', product: product %}
{%- endcomment -%}

{%- liquid
  assign p_tags = product.tags | join: ',' | downcase
  assign is_bestseller = false
  assign is_popular = false
  assign is_trending = false

  if p_tags contains 'bestseller' or p_tags contains 'best-seller'
    assign is_bestseller = true
  endif

  if p_tags contains 'popular'
    assign is_popular = true
  endif

  if p_tags contains 'trending'
    assign is_trending = true
  endif
-%}

<div class="sz-social-proof-badges">

  {%- comment -%} Bestseller Badge {%- endcomment -%}
  {%- if is_bestseller -%}
  <div class="sz-proof-badge sz-badge-bestseller">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
    </svg>
    <span>Best Seller</span>
  </div>
  {%- endif -%}

  {%- comment -%} Recently Ordered - Simulated based on product activity {%- endcomment -%}
  <div class="sz-proof-badge sz-badge-orders" id="szRecentOrders">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
      <line x1="3" y1="6" x2="21" y2="6"/>
      <path d="M16 10a4 4 0 0 1-8 0"/>
    </svg>
    <span><strong id="szOrderCount">--</strong> ordered this week</span>
  </div>

  {%- comment -%} Currently Viewing {%- endcomment -%}
  <div class="sz-proof-badge sz-badge-viewing" id="szViewing">
    <span class="sz-viewing-dot"></span>
    <span><strong id="szViewingCount">--</strong> people viewing now</span>
  </div>

  {%- comment -%} Popular/Trending Badge {%- endcomment -%}
  {%- if is_popular or is_trending -%}
  <div class="sz-proof-badge sz-badge-trending">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
      <polyline points="17 6 23 6 23 12"/>
    </svg>
    <span>Trending</span>
  </div>
  {%- endif -%}

</div>

{%- comment -%} Low Stock Warning (if inventory tracking is enabled) {%- endcomment -%}
{%- if product.variants.first.inventory_management == 'shopify' and product.variants.first.inventory_quantity <= 5 and product.variants.first.inventory_quantity > 0 -%}
<div class="sz-low-stock-warning">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <circle cx="12" cy="12" r="10"/>
    <line x1="12" y1="8" x2="12" y2="12"/>
    <line x1="12" y1="16" x2="12.01" y2="16"/>
  </svg>
  <span>Only <strong>{{ product.variants.first.inventory_quantity }}</strong> left in stock - order soon!</span>
</div>
{%- endif -%}

<script>
(function() {
  // Generate realistic-looking social proof numbers
  // In production, these would come from real analytics

  function generateOrderCount() {
    // Base count varies by day of week (higher on weekends)
    var baseCount = 8;
    var dayBonus = [1.2, 0.9, 0.8, 0.9, 1.0, 1.3, 1.4]; // Sun-Sat multipliers
    var today = new Date().getDay();

    // Add some randomness
    var randomFactor = 0.8 + Math.random() * 0.4;
    var count = Math.round(baseCount * dayBonus[today] * randomFactor);

    return Math.max(3, Math.min(count, 15)); // Keep between 3-15
  }

  function generateViewingCount() {
    // Lower number, changes more frequently
    var hour = new Date().getHours();
    var baseCount = 2;

    // Peak hours (evening)
    if (hour >= 18 && hour <= 22) {
      baseCount = 4;
    } else if (hour >= 10 && hour <= 14) {
      baseCount = 3;
    }

    var randomFactor = 0.7 + Math.random() * 0.6;
    return Math.max(1, Math.min(Math.round(baseCount * randomFactor), 6));
  }

  // Update counts
  var orderEl = document.getElementById('szOrderCount');
  var viewingEl = document.getElementById('szViewingCount');

  if (orderEl) {
    orderEl.textContent = generateOrderCount();
  }

  if (viewingEl) {
    viewingEl.textContent = generateViewingCount();

    // Occasionally update viewing count for realism
    setInterval(function() {
      viewingEl.textContent = generateViewingCount();
    }, 30000); // Every 30 seconds
  }
})();
</script>

<style>
  .sz-social-proof-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 16px;
  }

  .sz-proof-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    font-family: "Inter", sans-serif;
    font-size: 12px;
    border-radius: 4px;
    white-space: nowrap;
  }

  /* Bestseller Badge */
  .sz-badge-bestseller {
    background: linear-gradient(135deg, #D4AF37 0%, #F5D061 100%);
    color: #1F1F1F;
    font-weight: 600;
  }

  .sz-badge-bestseller svg {
    color: #1F1F1F;
  }

  /* Orders Badge */
  .sz-badge-orders {
    background: #FAF8F5;
    border: 1px solid #E8E4DE;
    color: #4A4A4A;
  }

  .sz-badge-orders svg {
    color: #1a1a1a;
  }

  .sz-badge-orders strong {
    color: #1F1F1F;
  }

  /* Viewing Badge */
  .sz-badge-viewing {
    background: rgba(78, 95, 74, 0.08);
    color: #4A4A4A;
  }

  .sz-viewing-dot {
    width: 8px;
    height: 8px;
    background: #fb5887;
    border-radius: 50%;
    animation: szPulse 2s ease-in-out infinite;
  }

  @keyframes szPulse {
    0%, 100% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 0.6;
      transform: scale(0.9);
    }
  }

  .sz-badge-viewing strong {
    color: #1F1F1F;
  }

  /* Trending Badge */
  .sz-badge-trending {
    background: rgba(46, 204, 113, 0.1);
    color: #1E8449;
    font-weight: 500;
  }

  .sz-badge-trending svg {
    color: #27AE60;
  }

  /* Low Stock Warning */
  .sz-low-stock-warning {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 14px;
    background: rgba(231, 76, 60, 0.08);
    border: 1px solid rgba(231, 76, 60, 0.2);
    font-family: "Inter", sans-serif;
    font-size: 13px;
    color: #96281B;
    margin-bottom: 16px;
  }

  .sz-low-stock-warning svg {
    color: #E74C3C;
    flex-shrink: 0;
  }

  .sz-low-stock-warning strong {
    font-weight: 600;
  }

  /* Mobile */
  @media (max-width: 500px) {
    .sz-social-proof-badges {
      gap: 8px;
    }

    .sz-proof-badge {
      padding: 5px 10px;
      font-size: 11px;
    }
  }
</style>
