{%- comment -%}
  Shelzy's Designs - Social Proof Notifications

  Shows recent purchase notifications to create urgency and social proof.
  Displays: "Sarah from California just purchased Bridesmaid Proposal Box"

  Features:
  - Rotates through recent/simulated purchases
  - Subtle animation
  - Dismissable
  - Respects user preferences (localStorage)
  - Mobile-friendly positioning
{%- endcomment -%}

<div id="sz-social-proof" class="sz-social-proof" role="status" aria-live="polite">
  <div class="sz-social-proof__content">
    <div class="sz-social-proof__image">
      <img src="" alt="" class="sz-social-proof__img">
    </div>
    <div class="sz-social-proof__text">
      <p class="sz-social-proof__message"></p>
      <p class="sz-social-proof__time"></p>
    </div>
    <button class="sz-social-proof__close" aria-label="Dismiss notification">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M18 6L6 18M6 6l12 12"/>
      </svg>
    </button>
  </div>
</div>

<style>
  .sz-social-proof {
    position: fixed;
    bottom: 20px;
    left: 20px;
    z-index: 9990;
    opacity: 0;
    transform: translateX(-20px);
    transition: all 0.4s ease;
    pointer-events: none;
  }

  .sz-social-proof.is-visible {
    opacity: 1;
    transform: translateX(0);
    pointer-events: auto;
  }

  .sz-social-proof__content {
    display: flex;
    align-items: center;
    gap: 12px;
    background: #fff;
    border-radius: 12px;
    padding: 12px 16px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    border: 1px solid #E0E3DF;
    max-width: 320px;
  }

  .sz-social-proof__image {
    flex-shrink: 0;
    width: 50px;
    height: 50px;
    border-radius: 8px;
    overflow: hidden;
    background: #FAF9F6;
  }

  .sz-social-proof__img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .sz-social-proof__text {
    flex-grow: 1;
    min-width: 0;
  }

  .sz-social-proof__message {
    font-size: 13px;
    color: #2B2B2B;
    margin: 0 0 3px;
    line-height: 1.3;
  }

  .sz-social-proof__message strong {
    color: #4E5F4A;
  }

  .sz-social-proof__time {
    font-size: 11px;
    color: #999;
    margin: 0;
  }

  .sz-social-proof__close {
    flex-shrink: 0;
    background: none;
    border: none;
    color: #999;
    cursor: pointer;
    padding: 4px;
    transition: color 0.2s;
  }

  .sz-social-proof__close:hover {
    color: #666;
  }

  /* Verified badge */
  .sz-social-proof__verified {
    display: inline-flex;
    align-items: center;
    gap: 3px;
    font-size: 10px;
    color: #8BAA88;
    margin-top: 4px;
  }

  .sz-social-proof__verified svg {
    width: 12px;
    height: 12px;
  }

  /* Mobile positioning */
  @media (max-width: 480px) {
    .sz-social-proof {
      left: 10px;
      right: 10px;
      bottom: 10px;
    }

    .sz-social-proof__content {
      max-width: none;
    }
  }
</style>

<script>
(function() {
  // Sample data (replace with real recent orders or keep as simulated)
  const notifications = [
    {
      name: 'Sarah',
      location: 'California',
      product: 'Bridesmaid Proposal Gift Box',
      image: '{{ "product-gift-box.jpg" | asset_url }}',
      time: '2 minutes ago'
    },
    {
      name: 'Jessica',
      location: 'Texas',
      product: 'Personalized Bridesmaid Bottle',
      image: '{{ "product-bridesmaid.jpg" | asset_url }}',
      time: '5 minutes ago'
    },
    {
      name: 'Amanda',
      location: 'Florida',
      product: 'Bridal Party 5-Pack Set',
      image: '{{ "product-5pack.jpg" | asset_url }}',
      time: '8 minutes ago'
    },
    {
      name: 'Michelle',
      location: 'New York',
      product: 'Custom Kids Bottle',
      image: '{{ "product-kids.jpg" | asset_url }}',
      time: '12 minutes ago'
    },
    {
      name: 'Emily',
      location: 'Washington',
      product: 'Holiday Personalized Bottle',
      image: '{{ "product-holiday.jpg" | asset_url }}',
      time: '15 minutes ago'
    },
    {
      name: 'Rachel',
      location: 'Colorado',
      product: 'Everyday Custom Bottle',
      image: '{{ "product-everyday.jpg" | asset_url }}',
      time: '18 minutes ago'
    }
  ];

  const STORAGE_KEY = 'sz_social_proof_dismissed';
  const SHOW_DELAY = 5000; // ms before first notification
  const DISPLAY_DURATION = 6000; // ms each notification shows
  const PAUSE_BETWEEN = 15000; // ms between notifications

  let currentIndex = 0;
  let isVisible = false;
  let isPaused = false;

  const container = document.getElementById('sz-social-proof');
  if (!container) return;

  const imageEl = container.querySelector('.sz-social-proof__img');
  const messageEl = container.querySelector('.sz-social-proof__message');
  const timeEl = container.querySelector('.sz-social-proof__time');
  const closeBtn = container.querySelector('.sz-social-proof__close');

  // Check if dismissed
  function isDismissed() {
    const dismissed = localStorage.getItem(STORAGE_KEY);
    if (!dismissed) return false;

    // Re-enable after 24 hours
    const dismissedTime = parseInt(dismissed, 10);
    const hoursSinceDismissed = (Date.now() - dismissedTime) / (1000 * 60 * 60);
    return hoursSinceDismissed < 24;
  }

  // Show notification
  function showNotification() {
    if (isPaused || isDismissed()) return;

    const notification = notifications[currentIndex];

    // Update content
    imageEl.src = notification.image;
    imageEl.alt = notification.product;
    messageEl.innerHTML = `<strong>${notification.name}</strong> from ${notification.location} just purchased <strong>${notification.product}</strong>`;
    timeEl.textContent = notification.time;

    // Show
    container.classList.add('is-visible');
    isVisible = true;

    // Hide after duration
    setTimeout(hideNotification, DISPLAY_DURATION);

    // Move to next
    currentIndex = (currentIndex + 1) % notifications.length;
  }

  // Hide notification
  function hideNotification() {
    container.classList.remove('is-visible');
    isVisible = false;

    // Schedule next
    if (!isPaused && !isDismissed()) {
      setTimeout(showNotification, PAUSE_BETWEEN);
    }
  }

  // Dismiss permanently (for session)
  function dismiss() {
    hideNotification();
    isPaused = true;
    localStorage.setItem(STORAGE_KEY, Date.now().toString());
  }

  // Event listeners
  closeBtn.addEventListener('click', dismiss);

  // Pause on hover
  container.addEventListener('mouseenter', function() {
    if (isVisible) {
      isPaused = true;
    }
  });

  container.addEventListener('mouseleave', function() {
    if (isVisible && !isDismissed()) {
      isPaused = false;
      setTimeout(hideNotification, 2000);
    }
  });

  // Initialize
  function init() {
    if (isDismissed()) return;

    // Don't show on cart/checkout
    if (window.location.pathname.includes('/cart') ||
        window.location.pathname.includes('/checkout')) {
      return;
    }

    // Randomize starting point
    currentIndex = Math.floor(Math.random() * notifications.length);

    // Start showing after delay
    setTimeout(showNotification, SHOW_DELAY);
  }

  // Run
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>
