{%- comment -%}
  Shelzy's Designs - Product Card Template

  Usage:
  {% render 'product-card', product: product, show_badges: true, show_rating: true %}

  Parameters:
  - product: The product object
  - show_badges: Show best seller/new badges (default: true)
  - show_rating: Show star rating (default: true)
  - show_quick_add: Show quick add button (default: false)
  - lazy_load: Lazy load images (default: true)
{%- endcomment -%}

{%- liquid
  assign show_badges = show_badges | default: true
  assign show_rating = show_rating | default: true
  assign show_quick_add = show_quick_add | default: false
  assign lazy_load = lazy_load | default: true

  assign current_variant = product.selected_or_first_available_variant
  assign featured_image = product.featured_image
-%}

<div class="sz-product-card" data-product-id="{{ product.id }}">

  {%- comment -%} Image container {%- endcomment -%}
  <div class="sz-product-card__image-wrapper">
    <a href="{{ product.url }}" class="sz-product-card__image-link" aria-label="{{ product.title }}">

      {%- comment -%} Product badges {%- endcomment -%}
      {%- if show_badges -%}
        <div class="sz-product-card__badges">
          {%- if product.tags contains 'bestseller' -%}
            <span class="sz-badge sz-badge--bestseller">Best Seller</span>
          {%- endif -%}
          {%- if product.created_at > 'now' | date: '%s' | minus: 2592000 | date: '%Y-%m-%d' -%}
            <span class="sz-badge sz-badge--new">New</span>
          {%- endif -%}
          {%- if product.compare_at_price > product.price -%}
            {%- assign savings = product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price -%}
            <span class="sz-badge sz-badge--sale">{{ savings }}% Off</span>
          {%- endif -%}
        </div>
      {%- endif -%}

      {%- comment -%} Primary image {%- endcomment -%}
      {%- if featured_image -%}
        <img
          class="sz-product-card__image sz-product-card__image--primary"
          src="{{ featured_image | image_url: width: 600 }}"
          alt="{{ featured_image.alt | escape | default: product.title }}"
          width="600"
          height="{{ 600 | divided_by: featured_image.aspect_ratio | round }}"
          {%- if lazy_load %} loading="lazy" decoding="async"{% endif %}
        >
      {%- endif -%}

      {%- comment -%} Secondary image on hover {%- endcomment -%}
      {%- if product.images.size > 1 -%}
        <img
          class="sz-product-card__image sz-product-card__image--secondary"
          src="{{ product.images[1] | image_url: width: 600 }}"
          alt="{{ product.images[1].alt | escape | default: product.title }}"
          width="600"
          height="{{ 600 | divided_by: product.images[1].aspect_ratio | round }}"
          loading="lazy"
          decoding="async"
        >
      {%- endif -%}

    </a>

    {%- comment -%} Quick add button {%- endcomment -%}
    {%- if show_quick_add and product.available -%}
      <button
        class="sz-product-card__quick-add"
        type="button"
        data-product-id="{{ product.id }}"
        data-variant-id="{{ current_variant.id }}"
        aria-label="Quick add {{ product.title }}"
      >
        <span class="sz-product-card__quick-add-text">Quick Add</span>
        <svg class="sz-product-card__quick-add-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M10 4V16M4 10H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    {%- endif -%}

  </div>

  {%- comment -%} Product info {%- endcomment -%}
  <div class="sz-product-card__info">

    {%- comment -%} Star rating {%- endcomment -%}
    {%- if show_rating -%}
      <div class="sz-product-card__rating">
        {%- comment -%} Replace with Judge.me or Yotpo widget if installed {%- endcomment -%}
        <div class="sz-stars" aria-label="4.9 out of 5 stars">
          {%- for i in (1..5) -%}
            <svg class="sz-star sz-star--filled" width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
            </svg>
          {%- endfor -%}
          <span class="sz-product-card__rating-count">({{ product.metafields.reviews.rating_count | default: '50+' }})</span>
        </div>
      </div>
    {%- endif -%}

    {%- comment -%} Product title {%- endcomment -%}
    <h3 class="sz-product-card__title">
      <a href="{{ product.url }}">{{ product.title }}</a>
    </h3>

    {%- comment -%} Product subtitle/vendor {%- endcomment -%}
    {%- if product.metafields.custom.subtitle -%}
      <p class="sz-product-card__subtitle">{{ product.metafields.custom.subtitle }}</p>
    {%- endif -%}

    {%- comment -%} Price {%- endcomment -%}
    <div class="sz-product-card__price">
      {%- if product.compare_at_price > product.price -%}
        <span class="sz-product-card__price--compare">{{ product.compare_at_price | money }}</span>
      {%- endif -%}
      <span class="sz-product-card__price--current{% if product.compare_at_price > product.price %} sz-product-card__price--sale{% endif %}">
        {%- if product.price_varies -%}
          From {{ product.price_min | money }}
        {%- else -%}
          {{ product.price | money }}
        {%- endif -%}
      </span>
    </div>

    {%- comment -%} Color swatches {%- endcomment -%}
    {%- if product.options_with_values.size > 0 -%}
      {%- for option in product.options_with_values -%}
        {%- if option.name == 'Color' -%}
          <div class="sz-product-card__swatches">
            {%- for value in option.values limit: 4 -%}
              <button
                class="sz-swatch sz-swatch--{{ value | handleize }}"
                aria-label="{{ value }}"
                data-color="{{ value }}"
              >
                <span class="visually-hidden">{{ value }}</span>
              </button>
            {%- endfor -%}
            {%- if option.values.size > 4 -%}
              <span class="sz-product-card__swatches-more">+{{ option.values.size | minus: 4 }}</span>
            {%- endif -%}
          </div>
        {%- endif -%}
      {%- endfor -%}
    {%- endif -%}

    {%- comment -%} Availability {%- endcomment -%}
    {%- unless product.available -%}
      <p class="sz-product-card__sold-out">Sold Out</p>
    {%- endunless -%}

  </div>

</div>

<style>
  .sz-product-card {
    position: relative;
    border-radius: 18px;
    background: #fff;
    overflow: hidden;
    transition: box-shadow 0.2s ease, transform 0.2s ease;
  }

  .sz-product-card:hover {
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    transform: translateY(-4px);
  }

  .sz-product-card__image-wrapper {
    position: relative;
    aspect-ratio: 1;
    overflow: hidden;
    background: #FAF9F6;
  }

  .sz-product-card__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: opacity 0.3s ease;
  }

  .sz-product-card__image--secondary {
    position: absolute;
    top: 0;
    left: 0;
    opacity: 0;
  }

  .sz-product-card:hover .sz-product-card__image--primary {
    opacity: 0;
  }

  .sz-product-card:hover .sz-product-card__image--secondary {
    opacity: 1;
  }

  .sz-product-card__badges {
    position: absolute;
    top: 12px;
    left: 12px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    z-index: 2;
  }

  .sz-badge {
    display: inline-block;
    padding: 4px 10px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    border-radius: 20px;
    font-family: var(--sz-font-accent, 'Montserrat', sans-serif);
  }

  .sz-badge--bestseller {
    background: #D1C7A1;
    color: #fff;
  }

  .sz-badge--new {
    background: #8BAA88;
    color: #fff;
  }

  .sz-badge--sale {
    background: #4E5F4A;
    color: #fff;
  }

  .sz-product-card__quick-add {
    position: absolute;
    bottom: 12px;
    left: 50%;
    transform: translateX(-50%) translateY(10px);
    background: #fff;
    border: 1px solid #8BAA88;
    color: #4E5F4A;
    padding: 10px 20px;
    border-radius: 999px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    opacity: 0;
    transition: all 0.2s ease;
    white-space: nowrap;
  }

  .sz-product-card:hover .sz-product-card__quick-add {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }

  .sz-product-card__quick-add:hover {
    background: #8BAA88;
    color: #fff;
  }

  .sz-product-card__info {
    padding: 16px;
  }

  .sz-product-card__rating {
    margin-bottom: 8px;
  }

  .sz-stars {
    display: flex;
    align-items: center;
    gap: 2px;
  }

  .sz-star {
    color: #8BAA88;
  }

  .sz-product-card__rating-count {
    font-size: 12px;
    color: #666;
    margin-left: 4px;
  }

  .sz-product-card__title {
    margin: 0 0 4px;
    font-family: var(--sz-font-heading, 'Playfair Display', serif);
    font-size: 15px;
    font-weight: 500;
    line-height: 1.3;
  }

  .sz-product-card__title a {
    color: #4E5F4A;
    text-decoration: none;
  }

  .sz-product-card__subtitle {
    margin: 0 0 8px;
    font-size: 12px;
    color: #888;
  }

  .sz-product-card__price {
    display: flex;
    align-items: center;
    gap: 8px;
    font-family: var(--sz-font-body, 'Inter', sans-serif);
  }

  .sz-product-card__price--current {
    font-size: 16px;
    font-weight: 600;
    color: #2B2B2B;
  }

  .sz-product-card__price--sale {
    color: #4E5F4A;
  }

  .sz-product-card__price--compare {
    font-size: 14px;
    color: #999;
    text-decoration: line-through;
  }

  .sz-product-card__swatches {
    display: flex;
    gap: 6px;
    margin-top: 10px;
  }

  .sz-swatch {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 2px solid #E0E3DF;
    cursor: pointer;
    transition: border-color 0.2s;
  }

  .sz-swatch:hover {
    border-color: #8BAA88;
  }

  .sz-swatch--white { background: #FFFFFF; }
  .sz-swatch--sage-green,
  .sz-swatch--sage { background: #8BAA88; }
  .sz-swatch--blush-pink,
  .sz-swatch--blush { background: #F8D9C5; }
  .sz-swatch--matte-black,
  .sz-swatch--black { background: #2B2B2B; }

  .sz-product-card__sold-out {
    margin: 8px 0 0;
    font-size: 12px;
    color: #cc0000;
    font-weight: 500;
  }
</style>
